<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pass Anxi√©t√© Pro - Version Unifi√©e</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        :root {
            --primary: #6B9BD1;
            --secondary: #A8D5BA;
            --danger: #F44336;
            --success: #4CAF50;
            --warning: #FF9800;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-calm: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gradient-calm);
            color: #2C3E50;
            min-height: 100vh;
        }

        .container { max-width: 600px; margin: 0 auto; padding: 20px; }
        .screen {
            display: none !important;
            min-height: 100vh;
            animation: fadeIn 0.3s ease-in;
        }

        .screen.active {
            display: block !important;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Header */
        header {
            background: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        header h1 { font-size: 1.8rem; color: var(--primary); }
        #current-time { font-size: 0.9rem; color: #666; margin-top: 5px; }

        .tool-header {
            background: white;
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .btn-back-icon {
            background: none;
            border: none;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--primary);
        }

        /* √âcran NFC */
        #nfc-screen {
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--gradient);
        }
        .nfc-card-visual {
            text-align: center;
            color: white;
            padding: 40px;
        }
        .nfc-card-visual h1 {
            font-size: 3rem;
            margin: 30px 0;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }
        .nfc-waves {
            width: 150px;
            height: 150px;
            margin: 0 auto;
            border-radius: 50%;
            background: rgba(255,255,255,0.2);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
        }

        /* Jauge anxi√©t√© */
        .anxiety-gauge {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .gauge-slider input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, var(--success) 0%, var(--warning) 50%, var(--danger) 100%);
            outline: none;
            -webkit-appearance: none;
        }
        .gauge-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        .gauge-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.9rem;
            color: #666;
        }
        .anxiety-value {
            text-align: center;
            margin-top: 15px;
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }

        /* Recommandation */
        .recommendation-card {
            background: var(--gradient);
            color: white;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
        }

        /* Grille outils */
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .tool-card {
            background: white;
            border: none;
            border-radius: 20px;
            padding: 25px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .tool-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .tool-icon { font-size: 3rem; display: block; margin-bottom: 10px; }
        .tool-card h3 { font-size: 1.1rem; margin-bottom: 5px; }
        .tool-card p { font-size: 0.85rem; color: #666; }

        /* Mode Crise */
        .emergency-header {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            text-align: center;
            padding: 40px 20px;
        }
        .emergency-header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .emergency-actions {
            display: flex;
            flex-direction: column;
            gap: 20px;
            margin: 30px 0;
        }
        .emergency-btn {
            background: white;
            border: none;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
            transition: all 0.3s ease;
        }
        .emergency-btn:hover { transform: scale(1.02); }
        .emergency-icon { font-size: 4rem; display: block; margin-bottom: 15px; }

        /* EMDR */
        .emdr-phase {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .emdr-phase h3 {
            color: var(--primary);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .phase-number {
            background: var(--gradient);
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .emdr-info-box {
            background: #f0f7ff;
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        .emdr-info-box.warning {
            background: #fff8e1;
            border-left-color: var(--warning);
        }
        .emdr-info-box.success {
            background: #e8f5e9;
            border-left-color: var(--success);
        }

        .sud-scale { margin: 20px 0; }
        .sud-slider { position: relative; margin: 30px 0; }
        .sud-slider input[type="range"] {
            width: 100%;
            height: 12px;
            border-radius: 6px;
            background: linear-gradient(to right, 
                #4CAF50 0%, #8BC34A 20%, #FFF176 40%, 
                #FFB74D 60%, #FF7043 80%, #F44336 100%);
            outline: none;
            -webkit-appearance: none;
        }
        .sud-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 3px 10px rgba(0,0,0,0.3);
            border: 3px solid var(--primary);
        }
        .sud-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 0.85rem;
            color: #666;
        }
        .sud-value {
            text-align: center;
            margin: 15px 0;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
        }
        .sud-description {
            text-align: center;
            font-size: 0.9rem;
            color: #666;
            font-style: italic;
        }

        .thought-prompts {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .prompt-item {
            background: white;
            padding: 12px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 3px solid var(--primary);
        }
        .prompt-item strong {
            color: var(--primary);
            display: block;
            margin-bottom: 5px;
        }

        .emdr-settings {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }
        .emdr-settings label { flex: 1; min-width: 150px; }
        .emdr-settings select {
            width: 100%;
            padding: 10px;
            border: 2px solid var(--primary);
            border-radius: 10px;
            font-size: 1rem;
            margin-top: 5px;
        }

        .distance-setup {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        .distance-icon { font-size: 4rem; margin: 20px 0; }
        .distance-measurement {
            background: var(--gradient-calm);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
        }
        .distance-value {
            font-size: 3rem;
            font-weight: bold;
            color: var(--primary);
            margin: 10px 0;
        }

        #emdr-canvas, #emdr-canvas-portrait {
            background: #000;
            width: 100%;
            height: 100%;
            min-height: 400px;
            border-radius: 20px;
            position: relative;
            overflow: hidden;
        }
        #emdr-canvas-landscape {
            flex: 1;
            background: #000;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        #emdr-dot, #emdr-dot-portrait, #emdr-dot-landscape {
            width: 50px;
            height: 50px;
            background: var(--gradient);
            border-radius: 50%;
            position: absolute;
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
            z-index: 5;
            /* Point centr√© par JavaScript */
        }

        .session-info-portrait {
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
        }
        .session-timer {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--primary);
        }

        .floating-instruction {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.95);
            padding: 15px 30px;
            border-radius: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            font-weight: 500;
            z-index: 50;
            animation: float 3s ease-in-out infinite;
        }
        @keyframes float {
            0%, 100% { transform: translateX(-50%) translateY(0); }
            50% { transform: translateX(-50%) translateY(-10px); }
        }

        .question-overlay {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0,0,0,0.95);
            color: white;
            padding: 20px;
            text-align: center;
            transform: translateY(100%);
            transition: transform 0.5s ease;
            z-index: 100;
        }
        .question-overlay.visible { transform: translateY(0); }
        .question-text { font-size: 1.3rem; margin: 15px 0; line-height: 1.6; }

        .sud-comparison {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .comparison-bars {
            display: flex;
            gap: 20px;
            margin: 30px 0;
            align-items: flex-end;
            height: 200px;
        }
        .comparison-bar { flex: 1; text-align: center; }
        .bar-container {
            position: relative;
            height: 180px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
        }
        .bar-fill {
            position: absolute;
            bottom: 0;
            width: 100%;
            background: var(--gradient);
            transition: height 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
        }
        .bar-fill.improved {
            background: linear-gradient(135deg, #4CAF50, #8BC34A);
        }
        .bar-label { margin-top: 10px; font-weight: 500; }

        .result-message {
            text-align: center;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            font-size: 1.1rem;
        }
        .result-message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 2px solid #4CAF50;
        }
        .result-message.warning {
            background: #fff8e1;
            color: #f57c00;
            border: 2px solid var(--warning);
        }

        /* Respiration */
        .breathing-info {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            margin: 20px 0;
        }
        #breathing-circle-container {
            height: 400px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin: 30px 0;
        }
        #breathing-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            box-shadow: 0 8px 30px rgba(107, 155, 209, 0.4);
            transition: all 5s cubic-bezier(0.4, 0, 0.2, 1);
        }
        #breathing-instruction {
            margin-top: 30px;
            font-size: 1.5rem;
            font-weight: 500;
        }
        #breathing-counter {
            text-align: center;
            font-size: 1.3rem;
            margin: 20px 0;
            color: var(--primary);
        }

        .timer {
            text-align: center;
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary);
            margin: 20px 0;
        }
        .instruction {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        /* Boutons */
        .btn-primary, .btn-secondary, .btn-back {
            padding: 15px 30px;
            border: none;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            width: 100%;
            margin: 10px 0;
        }
        .btn-primary {
            background: var(--gradient);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .btn-primary:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
            transform: translateY(-2px);
        }
        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }
        .btn-back { background: #f5f5f5; color: #2C3E50; }

        .emdr-controls, .breathing-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        .session-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
        }
        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 20px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        .control-btn.stop {
            background: var(--danger);
            color: white;
        }

        .control-btn.fullscreen {
            background: var(--primary);
            color: white;
        }

        .control-btn.fullscreen:hover {
            background: #5a8bc4;
        }

        .header-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        /* EMDR - Interface non-intrusive */
        .emdr-canvas {
            background: #000;
            border-radius: 10px;
            display: block;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .session-info-portrait {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            text-align: center;
            z-index: 10;
            pointer-events: none;
        }

        .session-controls {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
            background: rgba(0,0,0,0.8);
            padding: 8px 15px;
            border-radius: 25px;
        }

        .floating-instruction {
            position: absolute;
            bottom: 60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 8px 15px;
            border-radius: 15px;
            font-size: 0.9rem;
            text-align: center;
            z-index: 10;
            pointer-events: none;
        }

        /* Container EMDR avec positionnement relatif */
        .emdr-container {
            position: relative;
            width: 100%;
            height: 100%;
            min-height: 400px;
        }

        /* Styles plein √©cran EMDR - Interface non-intrusive */
        .emdr-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100vw !important;
            height: 100vh !important;
            z-index: 9999 !important;
            background: #000 !important;
            overflow: hidden !important;
        }

        .emdr-fullscreen .emdr-container {
            width: 100vw;
            height: 100vh;
            min-height: 100vh;
        }

        .emdr-fullscreen #emdr-canvas-portrait {
            width: 100vw !important;
            height: 100vh !important;
            min-height: 100vh !important;
            margin: 0 !important;
            border-radius: 0 !important;
            position: relative !important;
        }

        .emdr-fullscreen .session-info-portrait {
            top: 5px;
            left: 5px;
            right: 5px;
            font-size: 0.8rem;
            padding: 5px 10px;
            background: rgba(0,0,0,0.7);
        }

        .emdr-fullscreen .session-controls {
            bottom: 5px;
            padding: 5px 10px;
            background: rgba(0,0,0,0.7);
        }

        .emdr-fullscreen .floating-instruction {
            bottom: 50px;
            font-size: 0.8rem;
            padding: 5px 10px;
            background: rgba(0,0,0,0.7);
        }

        /* Mobile optimisations */
        @media (max-width: 768px) {
            .emdr-container {
                min-height: 300px;
            }
            
            .session-info-portrait {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            .control-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .floating-instruction {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }

        /* Mobile horizontal - Interface minimale */
        @media (max-width: 768px) and (orientation: landscape) {
            .emdr-container {
                min-height: 250px;
            }
            
            .session-info-portrait {
                top: 5px;
                font-size: 0.7rem;
                padding: 4px 8px;
            }
            
            .session-controls {
                bottom: 5px;
                padding: 4px 8px;
            }
            
            .control-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .floating-instruction {
                bottom: 35px;
                font-size: 0.7rem;
                padding: 4px 8px;
            }
        }

        /* Suivi */
        .stats-header {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2.5rem;
            font-weight: bold;
            color: var(--primary);
        }
        .stat-text {
            font-size: 1.2rem;
            color: var(--primary);
        }

        .orientation-recommendation {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: var(--gradient);
            color: white;
            padding: 15px 20px;
            text-align: center;
            z-index: 1000;
            display: none;
        }
        .orientation-recommendation.show { display: block; }
        .recommendation-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 10px;
        }
        .rec-btn {
            padding: 8px 20px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9rem;
        }
        .rec-btn.primary {
            background: white;
            color: var(--primary);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .tools-grid { grid-template-columns: 1fr; }
            .stats-grid { grid-template-columns: 1fr; }
            .emdr-settings { flex-direction: column; }
            .emdr-settings label { min-width: 100%; }
        }

        /* ============ STYLES TCC ============ */

        /* Distorsions cognitives */
        .distortions-list {
            margin: 20px 0;
        }
        .distortion-item {
            background: white;
            padding: 20px;
            margin: 15px 0;
            border-radius: 15px;
            border-left: 4px solid var(--warning);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .distortion-item h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .distortion-item p {
            margin: 5px 0;
            line-height: 1.5;
        }

        /* Roue des √©motions */
        .emotions-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin: 20px 0;
        }
        .emotion-btn {
            padding: 15px;
            border: 2px solid #e0e0e0;
            background: white;
            border-radius: 15px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            text-align: center;
        }
        .emotion-btn:hover {
            border-color: var(--primary);
            background: #f0f7ff;
        }
        .emotion-btn.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: white;
        }

        /* Intensit√© √©motions */
        .emotion-intensity {
            margin: 20px 0;
            padding: 20px;
            background: #f9f9f9;
            border-radius: 15px;
        }

        /* Strat√©gies de gestion */
        .coping-strategies {
            margin: 20px 0;
        }
        .strategy-category {
            margin: 20px 0;
        }
        .strategy-category h5 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }
        .strategy-btn {
            display: block;
            width: 100%;
            padding: 12px;
            margin: 8px 0;
            border: 2px solid var(--secondary);
            background: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: left;
        }
        .strategy-btn:hover {
            background: var(--secondary);
            color: white;
        }

        /* Journal de bord */
        .journal-entry-form {
            background: white;
            padding: 25px;
            border-radius: 20px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .journal-section {
            margin: 20px 0;
        }
        .journal-section h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1rem;
        }
        .journal-section textarea {
            width: 100%;
            min-height: 80px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
        }
        .journal-section textarea:focus {
            outline: none;
            border-color: var(--primary);
        }

        .mood-slider {
            margin: 15px 0;
        }
        .mood-slider input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: linear-gradient(to right, 
                #F44336 0%, #FF9800 25%, #FFC107 50%, 
                #8BC34A 75%, #4CAF50 100%);
            outline: none;
            -webkit-appearance: none;
        }
        .mood-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .journal-actions {
            display: flex;
            gap: 15px;
            margin: 20px 0;
        }

        .journal-history {
            background: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .journal-entry-item {
            border-left: 4px solid var(--primary);
            padding: 15px;
            margin: 10px 0;
            background: #f9f9f9;
            border-radius: 5px;
        }
        .journal-entry-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .journal-entry-mood {
            color: var(--primary);
        }

        /* Techniques pratiques */
        .techniques-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .technique-card {
            background: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }
        .technique-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .technique-card h4 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }
        .technique-card p {
            font-size: 0.9rem;
            color: #666;
            margin-bottom: 15px;
        }

        /* Overlay pour techniques */
        .technique-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.9);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }
        .technique-overlay.visible {
            opacity: 1;
            visibility: visible;
        }
        .technique-content {
            text-align: center;
            padding: 40px;
            max-width: 600px;
        }
        .technique-content h2 {
            font-size: 2rem;
            margin-bottom: 20px;
        }
        .technique-content p {
            font-size: 1.2rem;
            margin: 15px 0;
            line-height: 1.6;
        }
        .technique-close {
            position: absolute;
            top: 20px;
            right: 20px;
            background: none;
            border: none;
            color: white;
            font-size: 2rem;
            cursor: pointer;
        }

        /* Mobile optimisations EMDR */
        @media (max-width: 768px) {
            .emdr-container {
                min-height: 300px;
            }
            
            #emdr-canvas-portrait {
                min-height: 250px;
                border-radius: 15px;
            }
            
            .session-info-portrait {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
            
            .control-btn {
                padding: 8px 12px;
                font-size: 0.9rem;
            }
            
            .floating-instruction {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }

        /* Mobile horizontal - Interface minimale et canvas optimal */
        @media (max-width: 768px) and (orientation: landscape) {
            .emdr-container {
                min-height: 200px;
            }
            
            #emdr-canvas-portrait {
                min-height: 180px;
                border-radius: 10px;
            }
            
            .session-info-portrait {
                top: 5px;
                font-size: 0.7rem;
                padding: 4px 8px;
            }
            
            .session-controls {
                bottom: 5px;
                padding: 4px 8px;
            }
            
            .control-btn {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .floating-instruction {
                bottom: 35px;
                font-size: 0.7rem;
                padding: 4px 8px;
            }
        }

        /* Historique des exercices de pens√©es */
        .thoughts-history-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .history-header h3 {
            color: var(--primary);
            margin: 0;
        }

        .history-actions {
            display: flex;
            gap: 10px;
        }

        .thoughts-history-list {
            max-height: 500px;
            overflow-y: auto;
        }

        .thought-history-item {
            border-left: 4px solid var(--primary);
            padding: 20px;
            margin: 15px 0;
            background: #f9f9f9;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .thought-history-item:hover {
            background: #f0f7ff;
            transform: translateX(5px);
        }

        .thought-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .thought-date {
            color: #666;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .thought-actions {
            display: flex;
            gap: 10px;
        }

        .thought-action-btn {
            padding: 6px 12px;
            border: 1px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 15px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s;
        }

        .thought-action-btn:hover {
            background: var(--primary);
            color: white;
        }

        .thought-action-btn.delete {
            border-color: var(--danger);
            color: var(--danger);
        }

        .thought-action-btn.delete:hover {
            background: var(--danger);
            color: white;
        }

        .thought-content {
            margin: 15px 0;
        }

        .thought-section {
            margin: 12px 0;
        }

        .thought-section-title {
            font-weight: 600;
            color: var(--primary);
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        .thought-section-content {
            background: white;
            padding: 12px;
            border-radius: 8px;
            border-left: 3px solid var(--secondary);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        .thought-section-content.alternative {
            border-left-color: var(--success);
            background: #f0fff4;
        }

        .thoughts-empty {
            text-align: center;
            padding: 40px 20px;
            color: #999;
            font-style: italic;
        }

        .thoughts-empty-icon {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        /* ============ FIN STYLES TCC ============ */

        /* ============ STYLES SYST√àME ACTIVATION ============ */

        /* √âcran d'activation */
        .activation-screen {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .activation-container {
            width: 100%;
            max-width: 500px;
        }

        .activation-card {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }

        .activation-header h1 {
            color: var(--primary);
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .activation-header h2 {
            color: #2C3E50;
            font-size: 1.3rem;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .activation-header p {
            color: #666;
            font-size: 0.95rem;
            margin-bottom: 30px;
        }

        /* Visuel carte */
        .card-visual {
            position: relative;
            margin: 30px 0;
            padding: 20px;
        }

        .nfc-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .nfc-waves-activation {
            width: 100px;
            height: 100px;
            margin: 0 auto;
            border-radius: 50%;
            background: rgba(102, 126, 234, 0.2);
            position: relative;
            animation: pulseActivation 2s infinite;
        }

        @keyframes pulseActivation {
            0%, 100% { 
                transform: scale(1); 
                opacity: 1; 
                box-shadow: 0 0 0 0 rgba(102, 126, 234, 0.7);
            }
            50% { 
                transform: scale(1.1); 
                opacity: 0.8; 
                box-shadow: 0 0 0 20px rgba(102, 126, 234, 0);
            }
        }

        /* M√©thodes d'activation */
        .activation-methods {
            margin: 30px 0;
        }

        .method-section {
            margin: 25px 0;
            padding: 20px;
            border: 2px solid #f0f0f0;
            border-radius: 15px;
            transition: all 0.3s;
        }

        .method-section:hover {
            border-color: var(--primary);
            background: #f8fafe;
        }

        .method-section h3 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .method-section p {
            color: #666;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .method-divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: #999;
            font-weight: 500;
        }

        .method-divider::before,
        .method-divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e0e0e0;
        }

        .method-divider span {
            padding: 0 15px;
            background: white;
        }

        /* Code d'activation */
        .code-input-container {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .activation-input {
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 1.2rem;
            text-align: center;
            font-family: 'Courier New', monospace;
            font-weight: bold;
            letter-spacing: 2px;
            transition: all 0.3s;
        }

        .activation-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .activation-btn {
            padding: 15px 25px;
            background: var(--gradient);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .activation-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .activation-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Bouton NFC */
        .nfc-btn {
            padding: 15px 25px;
            background: #f0f7ff;
            color: var(--primary);
            border: 2px solid var(--primary);
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            width: 100%;
        }

        .nfc-btn:hover {
            background: var(--primary);
            color: white;
        }

        .nfc-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 8px;
            font-size: 0.9rem;
            display: none;
        }

        .nfc-status.active {
            display: block;
            background: #e3f2fd;
            color: var(--primary);
        }

        .nfc-status.error {
            display: block;
            background: #ffebee;
            color: var(--danger);
        }

        .nfc-status.success {
            display: block;
            background: #e8f5e9;
            color: var(--success);
        }

        /* Messages d'erreur */
        .error-message {
            margin-top: 10px;
            padding: 10px;
            background: #ffebee;
            color: var(--danger);
            border-radius: 8px;
            font-size: 0.9rem;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        /* Section info s√©curit√© */
        .activation-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            margin: 25px 0;
            text-align: left;
        }

        .activation-info h4 {
            color: var(--primary);
            margin-bottom: 15px;
            text-align: center;
        }

        .activation-info ul {
            list-style: none;
            padding: 0;
        }

        .activation-info li {
            margin: 8px 0;
            font-size: 0.9rem;
            color: #555;
        }

        /* Lien d'achat */
        .purchase-link {
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid #e0e0e0;
        }

        .purchase-link p {
            color: #666;
            margin-bottom: 10px;
            font-size: 0.9rem;
        }

        .purchase-btn {
            display: inline-block;
            padding: 12px 20px;
            background: #ff6b35;
            color: white;
            text-decoration: none;
            border-radius: 10px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .purchase-btn:hover {
            background: #e55a2b;
            transform: translateY(-2px);
        }

        /* Responsive activation */
        @media (max-width: 768px) {
            .activation-card {
                padding: 20px;
                margin: 10px;
            }
            
            .activation-header h1 {
                font-size: 1.5rem;
            }
            
            .code-input-container {
                gap: 15px;
            }
        }

        /* ============ FIN STYLES ACTIVATION ============ */

        /* Animation pour notifications */
        @keyframes slideDown {
            from { transform: translateX(-50%) translateY(-100%); opacity: 0; }
            to { transform: translateX(-50%) translateY(0); opacity: 1; }
        }
    </style>
</head>
<body>
    <!-- Recommandation orientation -->
    <div id="orientation-recommendation" class="orientation-recommendation">
        <p><strong>üí° Mode Paysage Recommand√© pour EMDR</strong></p>
        <div class="recommendation-buttons">
            <button class="rec-btn primary" onclick="hideOrientationRecommendation()">J'ai compris</button>
        </div>
    </div>

    <!-- ============ SYST√àME D'ACTIVATION CARTE UNIQUE ============ -->
    
    <!-- √âcran d'activation obligatoire -->
    <div id="activation-screen" class="screen activation-screen active">
        <div class="activation-container">
            <div class="activation-card">
                <div class="activation-header">
                    <h1>üåü Pass Anxi√©t√© Pro</h1>
                    <h2>Activation Carte Unique</h2>
                    <p>Cette application n√©cessite votre carte physique exclusive</p>
                </div>

                <div class="activation-content">
                    <div class="card-visual">
                        <div class="nfc-icon">üì±</div>
                        <div class="nfc-waves-activation"></div>
                    </div>

                    <div class="activation-methods">
                        <div class="method-section">
                            <h3>üî¢ Code d'Activation</h3>
                            <p>Saisissez le code unique grav√© sur votre carte :</p>
                            <div class="code-input-container">
                                <input 
                                    type="text" 
                                    id="activation-code" 
                                    placeholder="XXXX-XXXX"
                                    maxlength="9"
                                    class="activation-input"
                                >
                                <button class="activation-btn" onclick="activateWithCode()">
                                    ‚ú® Activer ‚ú®
                                </button>
                            </div>
                            <div id="code-error" class="error-message"></div>
                        </div>

                        <div class="method-divider">
                            <span>OU</span>
                        </div>

                        <div class="method-section">
                            <h3>üì± Scan NFC</h3>
                            <p>Approchez votre carte de votre t√©l√©phone :</p>
                            <button class="nfc-btn" onclick="activateWithNFC()">
                                üì° Scanner ma carte NFC
                            </button>
                            <div id="nfc-status" class="nfc-status"></div>
                        </div>
                    </div>

                    <div class="activation-info">
                        <h4>üõ°Ô∏è S√©curit√© & Exclusivit√©</h4>
                        <ul>
                            <li>‚úÖ Chaque carte est unique et tra√ßable</li>
                            <li>‚úÖ Protection contre le partage non autoris√©</li>
                            <li>‚úÖ Acc√®s illimit√© √† votre propri√©taire uniquement</li>
                            <li>‚úÖ Mise √† jour automatique du contenu</li>
                        </ul>
                    </div>

                    <div class="purchase-link">
                        <p>Vous n'avez pas encore votre carte Pass Anxi√©t√© ?</p>
                        <a href="https://www.hypnotarot.fr/" target="_blank" class="purchase-btn" onclick="trackPurchaseClick()">üõí Commander sur HypnoTarot.fr</a>
                        <p style="font-size: 0.8rem; color: #888; margin-top: 10px;">
                            Livraison mondiale ‚Ä¢ Carte unique ‚Ä¢ Garantie 30 jours
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ FIN SYST√àME ACTIVATION ============ -->

    <!-- √âcran NFC (masqu√© par d√©faut maintenant) -->
    <div id="nfc-screen" class="screen">
        <div class="container">
            <div class="nfc-card-visual">
                <div class="nfc-waves"></div>
                <h1>üå∏ Pass Anxi√©t√©</h1>
                <p style="font-size: 1.2rem; opacity: 0.9;">Application Compl√®te Pro</p>
            </div>
            <button id="skip-nfc" class="btn-secondary">Commencer</button>
        </div>
    </div>

    <!-- √âcran Accueil -->
    <div id="home-screen" class="screen">
        <header>
            <h1>üå∏ Pass Anxi√©t√© Pro</h1>
            <div id="current-time"></div>
        </header>

        <div class="container">
            <div class="anxiety-gauge">
                <h2>Comment vous sentez-vous maintenant ?</h2>
                <div class="gauge-slider">
                    <input type="range" id="anxiety-level" min="0" max="10" value="5">
                    <div class="gauge-labels">
                        <span>üòå Calme</span>
                        <span>üò∞ Tr√®s anxieux</span>
                    </div>
                </div>
                <p class="anxiety-value">Niveau : <span id="anxiety-display">5</span>/10</p>
            </div>

            <div class="recommendation-card">
                <h3>üéØ Recommand√© pour vous maintenant</h3>
                <div id="recommended-tool"></div>
            </div>

            <div class="tools-grid">
                <button class="tool-card" data-tool="crisis">
                    <span class="tool-icon">üö®</span>
                    <h3>Mode Crise</h3>
                    <p>Aide imm√©diate</p>
                </button>

                <button class="tool-card" data-tool="emdr">
                    <span class="tool-icon">üëÅÔ∏è</span>
                    <h3>EMDR Pro</h3>
                    <p>Th√©rapie professionnelle</p>
                </button>

                <button class="tool-card" data-tool="breathing">
                    <span class="tool-icon">üíì</span>
                    <h3>Respiration</h3>
                    <p>Coh√©rence cardiaque</p>
                </button>

                <button class="tool-card" data-tool="tcc">
                    <span class="tool-icon">üß†</span>
                    <h3>TCC</h3>
                    <p>Pens√©es & √âmotions</p>
                </button>

                <button class="tool-card" data-tool="tracking">
                    <span class="tool-icon">üìä</span>
                    <h3>Suivi</h3>
                    <p>Vos progr√®s</p>
                </button>
            </div>
        </div>
    </div>

    <!-- √âcran Mode Crise -->
    <div id="crisis-screen" class="screen">
        <div class="emergency-header">
            <h1>üö® Mode Crise</h1>
            <p>Vous allez vous sentir mieux, respirez avec moi</p>
        </div>
        <div class="container">
            <div class="emergency-actions">
                <button class="emergency-btn" data-emergency="breathing">
                    <span class="emergency-icon">üí®</span>
                    <h3>Respiration</h3>
                    <p>Commencer maintenant</p>
                </button>
                <button class="emergency-btn" data-emergency="emdr">
                    <span class="emergency-icon">üëÅÔ∏è</span>
                    <h3>EMDR Complet</h3>
                    <p>Session guid√©e professionnelle</p>
                </button>
            </div>
            <button class="btn-back" data-back="home-screen">Retour</button>
        </div>
    </div>

    <!-- EMDR: Distance optimale -->
    <div id="emdr-distance" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="home-screen">‚Üê</button>
            <h1>Configuration Distance EMDR</h1>
        </header>
        <div class="container">
            <div class="distance-setup">
                <h2>üìè Distance Optimale</h2>
                <div class="distance-icon">üì±üëÅÔ∏è</div>
                
                <div class="emdr-info-box success">
                    <p><strong>üìö Recherche scientifique (Shapiro, 2001)</strong></p>
                    <p>La distance optimale pour l'EMDR est celle o√π les yeux effectuent des mouvements lat√©raux complets sans effort excessif.</p>
                </div>

                <div class="distance-measurement">
                    <h3>Distance recommand√©e :</h3>
                    <div class="distance-value">40-50 cm</div>
                    <p style="margin-top: 10px;">
                        <strong>üì± Smartphone :</strong> 40-50 cm (longueur d'un avant-bras)<br>
                        <strong>üíª Tablette :</strong> 50-60 cm<br>
                        <strong>üñ•Ô∏è Ordinateur :</strong> 60-70 cm
                    </p>
                </div>

                <div class="emdr-info-box warning">
                    <p><strong>üí° Mode Paysage vs Portrait :</strong></p>
                    <p><strong>üåü Paysage (horizontal) - RECOMMAND√â</strong></p>
                    <p>‚úÖ Amplitude maximale des mouvements oculaires</p>
                    <p>‚úÖ Plus efficace th√©rapeutiquement</p>
                </div>
            </div>

            <button class="btn-primary" onclick="goToScreen('emdr-setup')">
                Distance configur√©e ‚Üí
            </button>
        </div>
    </div>

    <!-- EMDR: Pr√©paration & SUD Initial -->
    <div id="emdr-setup" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="emdr-distance">‚Üê</button>
            <h1>Pr√©paration EMDR</h1>
        </header>
        <div class="container">
            <div class="emdr-phase">
                <h3><span class="phase-number">1</span> Identification de la cible</h3>
                
                <div class="emdr-info-box">
                    <p><strong>Choisissez un souvenir ou une situation qui vous d√©range</strong></p>
                </div>

                <div class="thought-prompts">
                    <h4>üí≠ Questions pour vous guider :</h4>
                    <div class="prompt-item">
                        <strong>Quelle image repr√©sente le pire moment ?</strong>
                        <p style="font-size: 0.9rem; color: #666;">Visualisez une "photo" mentale du moment le plus perturbant</p>
                    </div>
                    <div class="prompt-item">
                        <strong>Quelle pens√©e n√©gative avez-vous sur vous-m√™me ?</strong>
                        <p style="font-size: 0.9rem; color: #666;">Ex: "Je ne suis pas capable", "Je suis en danger"</p>
                    </div>
                    <div class="prompt-item">
                        <strong>O√π ressentez-vous cette √©motion dans votre corps ?</strong>
                        <p style="font-size: 0.9rem; color: #666;">Gorge serr√©e, ventre nou√©, poitrine oppress√©e...</p>
                    </div>
                </div>
            </div>

            <div class="emdr-phase">
                <h3><span class="phase-number">2</span> √âchelle SUD Initiale</h3>
                
                <div class="emdr-info-box">
                    <p><strong>√âvaluez votre niveau de d√©tresse MAINTENANT</strong></p>
                    <p>En pensant √† ce souvenir/situation, quel est votre niveau de malaise ?</p>
                </div>

                <div class="sud-scale">
                    <h4>Niveau de d√©tresse actuel :</h4>
                    <div class="sud-slider">
                        <input type="range" id="sud-before" min="0" max="10" value="5">
                    </div>
                    <div class="sud-labels">
                        <span>0 - Aucune d√©tresse</span>
                        <span>10 - D√©tresse maximale</span>
                    </div>
                    <div class="sud-value" id="sud-before-value">5</div>
                    <div class="sud-description" id="sud-before-desc">Malaise mod√©r√©</div>
                </div>
            </div>

            <div class="emdr-settings">
                <label>Mode Session :
                    <select id="emdr-mode">
                        <option value="professional">Mode Professionnel (4 s√©ries)</option>
                        <option value="quick">Mode Rapide (2 minutes)</option>
                        <option value="standard">Mode Standard (5 minutes)</option>
                    </select>
                </label>
                <label>Vitesse :
                    <select id="emdr-speed">
                        <option value="slow">Lent</option>
                        <option value="medium" selected>Moyen</option>
                        <option value="fast">Rapide</option>
                    </select>
                </label>
            </div>

            <button class="btn-primary" onclick="startEMDRSession()">
                Commencer la session EMDR ‚Üí
            </button>
        </div>
    </div>

    <!-- EMDR: Session Active -->
    <div id="emdr-session" class="screen">
        <div id="portrait-version" style="display: none;">
            <header class="tool-header">
                <h1>Session EMDR</h1>
            </header>
            <div class="container">
                <div class="emdr-container">
                    <div id="emdr-canvas-portrait">
                        <div id="emdr-dot-portrait"></div>
                    </div>
                    
                    <div class="session-info-portrait">
                        <div>S√©rie: <span id="current-series-portrait">1</span>/<span id="total-series-portrait">4</span></div>
                        <div class="session-timer" id="session-timer-portrait">2:00</div>
                    </div>

                    <div class="floating-instruction" id="floating-instruction-portrait">
                        Suivez le point avec vos yeux, sans bouger la t√™te<br>
                        <small style="opacity: 0.8; display: none;" id="keyboard-hint">üí° Appuyez sur F pour le plein √©cran</small>
                    </div>

                    <div class="session-controls">
                        <button class="control-btn fullscreen" onclick="toggleFullscreen()" id="fullscreen-btn">
                            üì∫ Plein √âcran
                        </button>
                        <button class="control-btn stop" onclick="stopEMDRSession()">‚ñ† Arr√™ter</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="question-overlay" id="question-overlay">
            <div class="question-text" id="question-text"></div>
            <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 10px;">Continuez √† suivre le point des yeux</div>
        </div>
    </div>

    <!-- EMDR: √âvaluation Finale -->
    <div id="emdr-evaluation" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="home-screen">‚Üê</button>
            <h1>√âvaluation Finale</h1>
        </header>
        <div class="container">
            <div class="emdr-phase">
                <h3><span class="phase-number">3</span> R√©√©valuation SUD</h3>
                
                <div class="emdr-info-box">
                    <p><strong>Pensez √† nouveau au souvenir/situation de d√©part</strong></p>
                    <p>Comment vous sentez-vous MAINTENANT ?</p>
                </div>

                <div class="sud-scale">
                    <h4>Niveau de d√©tresse actuel :</h4>
                    <div class="sud-slider">
                        <input type="range" id="sud-after" min="0" max="10" value="5">
                    </div>
                    <div class="sud-labels">
                        <span>0 - Aucune d√©tresse</span>
                        <span>10 - D√©tresse maximale</span>
                    </div>
                    <div class="sud-value" id="sud-after-value">5</div>
                    <div class="sud-description" id="sud-after-desc">Malaise mod√©r√©</div>
                </div>
            </div>

            <div class="sud-comparison" id="comparison-section" style="display:none;">
                <h3>üìä Comparaison Avant / Apr√®s</h3>
                <div class="comparison-bars">
                    <div class="comparison-bar">
                        <div class="bar-container">
                            <div class="bar-fill" id="bar-before">0</div>
                        </div>
                        <div class="bar-label">Avant</div>
                    </div>
                    <div class="comparison-bar">
                        <div class="bar-container">
                            <div class="bar-fill improved" id="bar-after">0</div>
                        </div>
                        <div class="bar-label">Apr√®s</div>
                    </div>
                </div>

                <div id="result-message" class="result-message"></div>

                <div class="emdr-info-box">
                    <p><strong>Interpr√©tation :</strong></p>
                    <p id="interpretation-text"></p>
                </div>
            </div>

            <button class="btn-primary" onclick="evaluateResults()">
                Valider mon √©valuation
            </button>
            <button class="btn-back" data-back="home-screen">Terminer</button>
        </div>
    </div>

    <!-- √âcran EMDR Simple -->
    <div id="emdr-simple" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="home-screen">‚Üê</button>
            <h1>EMDR - Mouvement Oculaire</h1>
        </header>
        <div class="container">
            <div class="emdr-settings">
                <label>Vitesse :
                    <select id="emdr-speed-simple">
                        <option value="slow">Lent</option>
                        <option value="medium" selected>Moyen</option>
                        <option value="fast">Rapide</option>
                    </select>
                </label>
                <label>Dur√©e :
                    <select id="emdr-duration-simple">
                        <option value="2">2 minutes</option>
                        <option value="5" selected>5 minutes</option>
                        <option value="10">10 minutes</option>
                    </select>
                </label>
            </div>

            <div id="emdr-canvas">
                <div id="emdr-dot"></div>
            </div>

            <div class="emdr-controls">
                <button id="emdr-start" class="btn-primary">Commencer</button>
                <button id="emdr-stop" class="btn-secondary" style="display:none;">Arr√™ter</button>
            </div>

            <div id="emdr-timer" class="timer">5:00</div>
            <p class="instruction">Suivez le point des yeux sans bouger la t√™te</p>
        </div>
    </div>

    <!-- √âcran Respiration -->
    <div id="breathing-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="home-screen">‚Üê</button>
            <h1>üíì Coh√©rence Cardiaque</h1>
        </header>
        <div class="container">
            <div class="breathing-info">
                <p>5 secondes d'inspiration - 5 secondes d'expiration</p>
                <p>Dur√©e recommand√©e : 5 minutes (30 cycles)</p>
            </div>

            <div id="breathing-circle-container">
                <div id="breathing-circle"></div>
                <div id="breathing-instruction">Pr√™t √† commencer</div>
            </div>

            <div id="breathing-counter">
                <span id="cycle-count">0</span> / 30 cycles
            </div>

            <div class="breathing-controls">
                <button id="breathing-start" class="btn-primary">Commencer</button>
                <button id="breathing-stop" class="btn-secondary" style="display:none;">Arr√™ter</button>
            </div>
        </div>
    </div>

    <!-- √âcran Suivi -->
    <div id="tracking-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="home-screen">‚Üê</button>
            <h1>üìä Votre Suivi</h1>
        </header>
        <div class="container">
            <div class="stats-header">
                <h2>Vos Statistiques</h2>
            </div>

            <div class="stats-grid">
                <div class="stat-card">
                    <h3>Sessions totales</h3>
                    <p class="stat-number" id="total-sessions">0</p>
                </div>
                <div class="stat-card">
                    <h3>Outil favori</h3>
                    <p class="stat-text" id="favorite-tool">-</p>
                </div>
                <div class="stat-card">
                    <h3>Niveau d'anxi√©t√©</h3>
                    <p class="stat-number" id="avg-anxiety">-</p>
                </div>
                <div class="stat-card">
                    <h3>S√©rie actuelle</h3>
                    <p class="stat-number" id="streak-days">0</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ SECTION TCC ============ -->
    
    <!-- √âcran TCC - Menu Principal -->
    <div id="tcc-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="home-screen">‚Üê</button>
            <h1>üß† TCC - Th√©rapie Cognitive & Comportementale</h1>
        </header>
        <div class="container">
            <div class="emdr-info-box">
                <p><strong>üí° La TCC vous aide √† :</strong></p>
                <p>‚Ä¢ Identifier et modifier vos pens√©es n√©gatives</p>
                <p>‚Ä¢ Mieux comprendre et g√©rer vos √©motions</p>
                <p>‚Ä¢ D√©velopper des strat√©gies d'adaptation</p>
                <p>‚Ä¢ Tenir un journal de bord de vos progr√®s</p>
            </div>

            <div class="tools-grid">
                <button class="tool-card" data-tool="thoughts">
                    <span class="tool-icon">üí≠</span>
                    <h3>Pens√©es</h3>
                    <p>Comprendre & modifier</p>
                </button>

                <button class="tool-card" data-tool="emotions">
                    <span class="tool-icon">‚ù§Ô∏è</span>
                    <h3>√âmotions</h3>
                    <p>G√©rer sa sensibilit√©</p>
                </button>

                <button class="tool-card" data-tool="journal">
                    <span class="tool-icon">üìù</span>
                    <h3>Journal</h3>
                    <p>Suivi quotidien</p>
                </button>

                <button class="tool-card" data-tool="techniques">
                    <span class="tool-icon">üõ†Ô∏è</span>
                    <h3>Techniques</h3>
                    <p>Outils pratiques</p>
                </button>
            </div>
        </div>
    </div>

    <!-- TCC: Travail sur les Pens√©es -->
    <div id="thoughts-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="tcc-screen">‚Üê</button>
            <h1>üí≠ Comprendre & Modifier ses Pens√©es</h1>
        </header>
        <div class="container">
            <div class="emdr-phase">
                <h3><span class="phase-number">1</span> Identifier les pens√©es automatiques</h3>
                
                <div class="emdr-info-box">
                    <p><strong>Les pens√©es automatiques n√©gatives (PAN)</strong> surgissent spontan√©ment et influencent notre humeur.</p>
                </div>

                <div class="thought-prompts">
                    <h4>üîç Exercice : Identifiez votre pens√©e actuelle</h4>
                    <textarea id="current-thought" placeholder="D√©crivez la pens√©e n√©gative qui vous pr√©occupe maintenant...&#10;&#10;Exemple : 'Je ne vais jamais y arriver' ou 'Tout le monde me juge'" style="width: 100%; height: 100px; padding: 15px; border: 2px solid var(--primary); border-radius: 10px; font-family: inherit; resize: vertical;"></textarea>
                </div>
            </div>

            <div class="emdr-phase">
                <h3><span class="phase-number">2</span> Analyser la pens√©e</h3>
                
                <div class="thought-prompts">
                    <h4>‚ùì Questions d'analyse :</h4>
                    <div class="prompt-item">
                        <strong>Cette pens√©e est-elle r√©aliste ?</strong>
                        <p style="font-size: 0.9rem; color: #666;">Y a-t-il des preuves pour et contre ?</p>
                    </div>
                    <div class="prompt-item">
                        <strong>Que dirais-je √† un ami dans cette situation ?</strong>
                        <p style="font-size: 0.9rem; color: #666;">Souvent nous sommes plus bienveillants envers les autres</p>
                    </div>
                    <div class="prompt-item">
                        <strong>Quel est le pire qui puisse arriver ?</strong>
                        <p style="font-size: 0.9rem; color: #666;">Et comment pourrais-je g√©rer cette situation ?</p>
                    </div>
                </div>
            </div>

            <div class="emdr-phase">
                <h3><span class="phase-number">3</span> Restructurer la pens√©e</h3>
                
                <div class="thought-prompts">
                    <h4>‚ú® Cr√©ez une pens√©e alternative :</h4>
                    <textarea id="alternative-thought" placeholder="Reformulez votre pens√©e de mani√®re plus √©quilibr√©e et r√©aliste...&#10;&#10;Exemple : 'C'est difficile mais je peux y arriver √©tape par √©tape' ou 'La plupart des gens sont pr√©occup√©s par eux-m√™mes, pas par moi'" style="width: 100%; height: 80px; padding: 15px; border: 2px solid var(--success); border-radius: 10px; font-family: inherit; resize: vertical;"></textarea>
                </div>

                <div class="emdr-info-box success">
                    <p><strong>üí° Crit√®res d'une pens√©e √©quilibr√©e :</strong></p>
                    <p>‚Ä¢ R√©aliste et factuelle</p>
                    <p>‚Ä¢ Bienveillante envers soi</p>
                    <p>‚Ä¢ Ax√©e sur les solutions</p>
                    <p>‚Ä¢ Encourage l'action positive</p>
                </div>
            </div>

            <button class="btn-primary" onclick="saveThoughtExercise()">
                üíæ Sauvegarder cet exercice
            </button>
            <button class="btn-secondary" onclick="showThoughtHistory()">
                üìö Voir mes exercices sauvegard√©s
            </button>
            <button class="btn-secondary" onclick="goToScreen('distortions-screen')">
                üîç Voir les distorsions cognitives
            </button>
        </div>
    </div>

    <!-- TCC: Historique des Exercices de Pens√©es -->
    <div id="thoughts-history-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="thoughts-screen">‚Üê</button>
            <h1>üìö Historique des Exercices de Pens√©es</h1>
        </header>
        <div class="container">
            <div class="emdr-info-box">
                <p><strong>üìñ Vos derniers exercices de restructuration cognitive</strong></p>
                <p>Relisez vos progr√®s et observez l'√©volution de votre travail sur les pens√©es n√©gatives.</p>
            </div>

            <div class="thoughts-history-container">
                <div class="history-header">
                    <h3>üí≠ Mes Exercices (Limite : 10 derniers)</h3>
                    <div class="history-actions">
                        <button class="action-btn" onclick="exportThoughts()">üì§ Exporter</button>
                        <button class="action-btn" onclick="clearThoughtsHistory()">üóëÔ∏è Effacer tout</button>
                    </div>
                </div>

                <div id="thoughts-history-list" class="thoughts-history-list">
                    <!-- Sera rempli par JavaScript -->
                </div>
            </div>

            <div class="emdr-info-box success">
                <p><strong>üí° Conseil th√©rapeutique :</strong></p>
                <p>Relire vos anciens exercices vous aide √† :</p>
                <p>‚Ä¢ <strong>Voir vos progr√®s</strong> dans la restructuration cognitive</p>
                <p>‚Ä¢ <strong>Identifier les patterns</strong> de pens√©es r√©currentes</p>
                <p>‚Ä¢ <strong>R√©utiliser les pens√©es alternatives</strong> efficaces</p>
                <p>‚Ä¢ <strong>Renforcer les apprentissages</strong> positifs</p>
            </div>

            <button class="btn-primary" onclick="goToScreen('thoughts-screen')">
                ‚úçÔ∏è Nouvel exercice de pens√©es
            </button>
        </div>
    </div>

    <!-- TCC: Distorsions Cognitives -->
    <div id="distortions-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="thoughts-screen">‚Üê</button>
            <h1>üîç Distorsions Cognitives</h1>
        </header>
        <div class="container">
            <div class="emdr-info-box">
                <p><strong>Les distorsions cognitives</strong> sont des fa√ßons biais√©es d'interpr√©ter la r√©alit√© qui maintiennent l'anxi√©t√©.</p>
            </div>

            <div class="distortions-list">
                <div class="distortion-item">
                    <h4>üîÆ Pens√©e catastrophique</h4>
                    <p><strong>Quoi :</strong> Imaginer le pire sc√©nario possible</p>
                    <p><strong>Exemple :</strong> "Si j'√©choue √† cet examen, ma vie est fichue"</p>
                    <p><strong>Antidote :</strong> "Quel est le sc√©nario le plus probable ?"</p>
                </div>

                <div class="distortion-item">
                    <h4>üé≠ Tout ou rien</h4>
                    <p><strong>Quoi :</strong> Voir les choses en noir ou blanc</p>
                    <p><strong>Exemple :</strong> "Je suis un √©chec total" ou "Je dois √™tre parfait"</p>
                    <p><strong>Antidote :</strong> "O√π suis-je sur une √©chelle de 1 √† 10 ?"</p>
                </div>

                <div class="distortion-item">
                    <h4>üîÆ Lecture de pens√©e</h4>
                    <p><strong>Quoi :</strong> Croire savoir ce que pensent les autres</p>
                    <p><strong>Exemple :</strong> "Ils pensent que je suis bizarre"</p>
                    <p><strong>Antidote :</strong> "Ai-je des preuves de ce que je pense ?"</p>
                </div>

                <div class="distortion-item">
                    <h4>üè∑Ô∏è √âtiquetage</h4>
                    <p><strong>Quoi :</strong> Se d√©finir par ses erreurs</p>
                    <p><strong>Exemple :</strong> "Je suis nul" au lieu de "J'ai fait une erreur"</p>
                    <p><strong>Antidote :</strong> "Que ferais-je diff√©remment la prochaine fois ?"</p>
                </div>

                <div class="distortion-item">
                    <h4>üîç Filtre mental</h4>
                    <p><strong>Quoi :</strong> Se concentrer uniquement sur le n√©gatif</p>
                    <p><strong>Exemple :</strong> Ignorer 9 compliments pour 1 critique</p>
                    <p><strong>Antidote :</strong> "Qu'est-ce qui s'est bien pass√© aussi ?"</p>
                </div>

                <div class="distortion-item">
                    <h4>üéØ Personnalisation</h4>
                    <p><strong>Quoi :</strong> Se bl√¢mer pour tout ce qui va mal</p>
                    <p><strong>Exemple :</strong> "C'est de ma faute si l'ambiance est mauvaise"</p>
                    <p><strong>Antidote :</strong> "Quels autres facteurs peuvent expliquer cela ?"</p>
                </div>
            </div>

            <button class="btn-primary" onclick="goToScreen('thoughts-screen')">
                ‚Üê Retour aux exercices
            </button>
        </div>
    </div>

    <!-- TCC: Travail sur les √âmotions -->
    <div id="emotions-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="tcc-screen">‚Üê</button>
            <h1>‚ù§Ô∏è Mieux G√©rer ses √âmotions</h1>
        </header>
        <div class="container">
            <div class="emdr-phase">
                <h3><span class="phase-number">1</span> Identifier l'√©motion</h3>
                
                <div class="emdr-info-box">
                    <p><strong>Premi√®re √©tape :</strong> Nommer pr√©cis√©ment ce que vous ressentez</p>
                </div>

                <div class="emotions-wheel">
                    <h4>üé® Roue des √©motions - Cliquez sur ce que vous ressentez :</h4>
                    <div class="emotions-grid">
                        <button class="emotion-btn" data-emotion="anxi√©t√©" data-intensity="0">üò∞ Anxi√©t√©</button>
                        <button class="emotion-btn" data-emotion="tristesse" data-intensity="0">üò¢ Tristesse</button>
                        <button class="emotion-btn" data-emotion="col√®re" data-intensity="0">üò† Col√®re</button>
                        <button class="emotion-btn" data-emotion="peur" data-intensity="0">üò® Peur</button>
                        <button class="emotion-btn" data-emotion="honte" data-intensity="0">üò≥ Honte</button>
                        <button class="emotion-btn" data-emotion="culpabilit√©" data-intensity="0">üòî Culpabilit√©</button>
                        <button class="emotion-btn" data-emotion="frustration" data-intensity="0">üò§ Frustration</button>
                        <button class="emotion-btn" data-emotion="d√©ception" data-intensity="0">üòû D√©ception</button>
                        <button class="emotion-btn" data-emotion="joie" data-intensity="0">üòä Joie</button>
                        <button class="emotion-btn" data-emotion="s√©r√©nit√©" data-intensity="0">üòå S√©r√©nit√©</button>
                    </div>
                </div>

                <div class="emotion-intensity" id="emotion-intensity-section" style="display:none;">
                    <h4>üìä Intensit√© de cette √©motion :</h4>
                    <div class="sud-slider">
                        <input type="range" id="emotion-intensity" min="1" max="10" value="5">
                    </div>
                    <div class="sud-labels">
                        <span>1 - Tr√®s l√©g√®re</span>
                        <span>10 - Tr√®s intense</span>
                    </div>
                    <div class="sud-value">
                        <span id="selected-emotion">√âmotion</span> : <span id="emotion-intensity-value">5</span>/10
                    </div>
                </div>
            </div>

            <div class="emdr-phase">
                <h3><span class="phase-number">2</span> Comprendre l'√©motion</h3>
                
                <div class="thought-prompts">
                    <h4>üîç Questions de compr√©hension :</h4>
                    <div class="prompt-item">
                        <strong>Qu'est-ce qui a d√©clench√© cette √©motion ?</strong>
                        <textarea id="emotion-trigger" placeholder="D√©crivez la situation, la pens√©e ou l'√©v√©nement qui a d√©clench√© cette √©motion..."></textarea>
                    </div>
                    <div class="prompt-item">
                        <strong>O√π ressentez-vous cette √©motion dans votre corps ?</strong>
                        <textarea id="emotion-body" placeholder="Gorge serr√©e, n≈ìud au ventre, tension dans les √©paules..."></textarea>
                    </div>
                    <div class="prompt-item">
                        <strong>Quel message cette √©motion vous envoie-t-elle ?</strong>
                        <p style="font-size: 0.9rem; color: #666;">Les √©motions sont des signaux. L'anxi√©t√© signale un danger potentiel, la col√®re une injustice, la tristesse une perte...</p>
                    </div>
                </div>
            </div>

            <div class="emdr-phase">
                <h3><span class="phase-number">3</span> Strat√©gies de gestion</h3>
                
                <div class="coping-strategies">
                    <h4>üõ†Ô∏è Choisissez une strat√©gie adapt√©e :</h4>
                    
                    <div class="strategy-category">
                        <h5>üí® Strat√©gies imm√©diates (urgence) :</h5>
                        <button class="strategy-btn" onclick="goToScreen('breathing-screen')">
                            Respiration 4-7-8
                        </button>
                        <button class="strategy-btn" onclick="startGroundingExercise()">
                            Technique 5-4-3-2-1
                        </button>
                        <button class="strategy-btn" onclick="startBodyScanExercise()">
                            Scan corporel rapide
                        </button>
                    </div>

                    <div class="strategy-category">
                        <h5>üß† Strat√©gies cognitives :</h5>
                        <button class="strategy-btn" onclick="goToScreen('thoughts-screen')">
                            Restructuration cognitive
                        </button>
                        <button class="strategy-btn" onclick="startDistanceExercise()">
                            Prise de distance
                        </button>
                        <button class="strategy-btn" onclick="startAcceptanceExercise()">
                            Acceptation √©motionnelle
                        </button>
                    </div>

                    <div class="strategy-category">
                        <h5>üéØ Strat√©gies comportementales :</h5>
                        <button class="strategy-btn" onclick="startActivityExercise()">
                            Activit√© plaisante
                        </button>
                        <button class="strategy-btn" onclick="startMovementExercise()">
                            Mouvement physique
                        </button>
                        <button class="strategy-btn" onclick="startSocialExercise()">
                            Contact social
                        </button>
                    </div>
                </div>
            </div>

            <button class="btn-primary" onclick="saveEmotionExercise()">
                üíæ Sauvegarder cette analyse
            </button>
        </div>
    </div>

    <!-- TCC: Journal de Bord -->
    <div id="journal-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="tcc-screen">‚Üê</button>
            <h1>üìù Journal de Bord TCC</h1>
        </header>
        <div class="container">
            <div class="emdr-info-box">
                <p><strong>üìñ Votre journal TCC</strong> vous aide √† prendre du recul et suivre vos progr√®s au quotidien.</p>
            </div>

            <div class="journal-entry-form">
                <h3>‚úçÔ∏è Nouvelle entr√©e - <span id="current-date"></span></h3>
                
                <div class="journal-section">
                    <h4>üå§Ô∏è Humeur g√©n√©rale aujourd'hui :</h4>
                    <div class="mood-slider">
                        <input type="range" id="daily-mood" min="1" max="10" value="5">
                        <div class="sud-labels">
                            <span>üòî Tr√®s mauvaise</span>
                            <span>üòä Excellente</span>
                        </div>
                        <div class="sud-value">
                            Humeur : <span id="mood-value">5</span>/10
                        </div>
                    </div>
                </div>

                <div class="journal-section">
                    <h4>üí≠ Pens√©es principales de la journ√©e :</h4>
                    <textarea id="daily-thoughts" placeholder="Quelles ont √©t√© vos principales pr√©occupations ou pens√©es r√©currentes aujourd'hui ?"></textarea>
                </div>

                <div class="journal-section">
                    <h4>‚ù§Ô∏è √âmotions ressenties :</h4>
                    <textarea id="daily-emotions" placeholder="D√©crivez les principales √©motions v√©cues et leur intensit√©..."></textarea>
                </div>

                <div class="journal-section">
                    <h4>‚ö° Situations d√©clenchantes :</h4>
                    <textarea id="daily-triggers" placeholder="Y a-t-il eu des situations particuli√®rement difficiles ? Comment avez-vous r√©agi ?"></textarea>
                </div>

                <div class="journal-section">
                    <h4>üõ†Ô∏è Strat√©gies utilis√©es :</h4>
                    <textarea id="daily-strategies" placeholder="Quelles techniques avez-vous utilis√©es ? Ont-elles √©t√© efficaces ?"></textarea>
                </div>

                <div class="journal-section">
                    <h4>üåü Points positifs :</h4>
                    <textarea id="daily-positives" placeholder="Notez 3 choses positives de votre journ√©e, m√™me petites..."></textarea>
                </div>

                <div class="journal-section">
                    <h4>üéØ Objectif pour demain :</h4>
                    <textarea id="daily-goal" placeholder="Un petit objectif r√©alisable pour demain..."></textarea>
                </div>
            </div>

            <div class="journal-actions">
                <button class="btn-primary" onclick="saveJournalEntry()">
                    üíæ Sauvegarder cette entr√©e
                </button>
                <button class="btn-secondary" onclick="showJournalHistory()">
                    üìö Voir l'historique
                </button>
            </div>

            <div class="journal-history" id="journal-history" style="display:none;">
                <h3>üìö Historique de votre journal</h3>
                <div id="journal-entries-list">
                    <!-- Sera rempli par JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- TCC: Techniques Pratiques -->
    <div id="techniques-screen" class="screen">
        <header class="tool-header">
            <button class="btn-back-icon" data-back="tcc-screen">‚Üê</button>
            <h1>üõ†Ô∏è Techniques TCC Pratiques</h1>
        </header>
        <div class="container">
            <div class="techniques-grid">
                <div class="technique-card">
                    <h4>üî¢ Technique 5-4-3-2-1</h4>
                    <p>Pour l'ancrage en cas de crise d'anxi√©t√©</p>
                    <button class="btn-secondary" onclick="startGroundingTechnique()">Commencer</button>
                </div>

                <div class="technique-card">
                    <h4>üé≠ Dialogue avec ses pens√©es</h4>
                    <p>Questionner ses pens√©es n√©gatives</p>
                    <button class="btn-secondary" onclick="startThoughtDialogue()">Commencer</button>
                </div>

                <div class="technique-card">
                    <h4>üìä Graphique √©motionnel</h4>
                    <p>Visualiser l'√©volution de ses √©motions</p>
                    <button class="btn-secondary" onclick="showEmotionChart()">Voir</button>
                </div>

                <div class="technique-card">
                    <h4>‚ö° Plan d'action anti-crise</h4>
                    <p>Strat√©gies personnalis√©es d'urgence</p>
                    <button class="btn-secondary" onclick="createCrisisPlan()">Cr√©er</button>
                </div>

                <div class="technique-card">
                    <h4>üéØ Exposition graduelle</h4>
                    <p>Affronter progressivement ses peurs</p>
                    <button class="btn-secondary" onclick="startExposureExercise()">Planifier</button>
                </div>

                <div class="technique-card">
                    <h4>üèÜ Journal des r√©ussites</h4>
                    <p>Valoriser ses progr√®s et succ√®s</p>
                    <button class="btn-secondary" onclick="showSuccessJournal()">Ouvrir</button>
                </div>
            </div>
        </div>
    </div>

    <!-- ============ FIN SECTION TCC ============ -->

    <script>
        // Variables globales
        let emdrInterval = null;
        let emdrTimeRemaining = 0;
        let emdrTimerInterval = null;
        let sudBefore = 5;
        let sudAfter = 5;
        let currentSeries = 0;
        let totalSeries = 4;
        let questionInterval = null;
        let currentMode = 'portrait';
        let recommendationDismissed = false;
        let breathingInterval = null;
        let breathingCycles = 0;
        let isActivated = false;
        let wakeLock = null; // Pour maintenir l'√©cran allum√©

        // ============ SYST√àME WAKE LOCK (√âCRAN ALLUM√â) ============

        // Demander de maintenir l'√©cran allum√©
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('üîã √âcran maintenu allum√©');
                    
                    // √âcouter si le wake lock est lib√©r√©
                    wakeLock.addEventListener('release', () => {
                        console.log('üí§ Wake Lock lib√©r√©');
                    });
                    
                    return true;
                } else {
                    console.log('‚ö†Ô∏è Wake Lock API non support√©e');
                    return false;
                }
            } catch (err) {
                console.error('‚ùå Erreur Wake Lock:', err);
                return false;
            }
        }

        // Lib√©rer le wake lock
        async function releaseWakeLock() {
            if (wakeLock !== null) {
                try {
                    await wakeLock.release();
                    wakeLock = null;
                    console.log('üí§ Wake Lock lib√©r√© manuellement');
                } catch (err) {
                    console.error('‚ùå Erreur lib√©ration Wake Lock:', err);
                }
            }
        }

        // R√©activer le wake lock quand l'onglet redevient visible
        document.addEventListener('visibilitychange', async () => {
            if (wakeLock !== null && document.visibilityState === 'visible') {
                try {
                    wakeLock = await navigator.wakeLock.request('screen');
                    console.log('üîã Wake Lock r√©activ√©');
                } catch (err) {
                    console.error('‚ùå Erreur r√©activation Wake Lock:', err);
                }
            }
        });

        // G√©rer le wake lock selon l'√©cran actif
        function manageWakeLockForScreen(screenId) {
            const wakeLockScreens = [
                'emdr-session', 
                'emdr-simple', 
                'breathing-screen'
            ];
            
            if (wakeLockScreens.includes(screenId)) {
                // Activer le wake lock pour les √©crans th√©rapeutiques
                requestWakeLock();
            } else {
                // Lib√©rer le wake lock pour les autres √©crans
                releaseWakeLock();
            }
        }

        // ============ FIN SYST√àME WAKE LOCK ============

        // ============ SYST√àME PLEIN √âCRAN EMDR ============

        let isFullscreen = false;

        // Basculer en mode plein √©cran
        async function toggleFullscreen() {
            try {
                if (!isFullscreen) {
                    // Entrer en plein √©cran
                    const emdrSession = document.getElementById('emdr-session');
                    
                    if (emdrSession.requestFullscreen) {
                        await emdrSession.requestFullscreen();
                    } else if (emdrSession.webkitRequestFullscreen) {
                        await emdrSession.webkitRequestFullscreen();
                    } else if (emdrSession.msRequestFullscreen) {
                        await emdrSession.msRequestFullscreen();
                    }
                    
                    // Appliquer les styles plein √©cran
                    emdrSession.classList.add('emdr-fullscreen');
                    isFullscreen = true;
                    
                    // Redimensionner le canvas pour le plein √©cran
                    setTimeout(() => {
                        resizeEMDRCanvas();
                    }, 100);
                    
                    // Mettre √† jour les boutons
                    updateFullscreenButtons('üì± Quitter Plein √âcran');
                    
                    // Notification
                    showFullscreenNotification('üì∫ Mode plein √©cran activ√©');
                    
                } else {
                    // Quitter le plein √©cran
                    await exitFullscreen();
                }
            } catch (error) {
                console.log('Plein √©cran non support√©:', error);
                // Fallback: plein √©cran simul√©
                toggleSimulatedFullscreen();
            }
        }

        // Quitter le plein √©cran
        async function exitFullscreen() {
            try {
                if (document.exitFullscreen) {
                    await document.exitFullscreen();
                } else if (document.webkitExitFullscreen) {
                    await document.webkitExitFullscreen();
                } else if (document.msExitFullscreen) {
                    await document.msExitFullscreen();
                }
            } catch (error) {
                console.log('Erreur sortie plein √©cran:', error);
            }
            
            // Retirer les styles plein √©cran
            const emdrSession = document.getElementById('emdr-session');
            emdrSession.classList.remove('emdr-fullscreen');
            isFullscreen = false;
            
            // Redimensionner le canvas pour le mode normal
            setTimeout(() => {
                resizeEMDRCanvas();
            }, 100);
            
            // Mettre √† jour les boutons
            updateFullscreenButtons('üì∫ Plein √âcran');
        }

        // Plein √©cran simul√© (fallback)
        function toggleSimulatedFullscreen() {
            const emdrSession = document.getElementById('emdr-session');
            
            if (!isFullscreen) {
                emdrSession.classList.add('emdr-fullscreen');
                isFullscreen = true;
                updateFullscreenButtons('üì± Quitter Plein √âcran');
                showFullscreenNotification('üì∫ Mode plein √©cran activ√©');
                
                // Redimensionner le canvas
                setTimeout(() => {
                    resizeEMDRCanvas();
                }, 100);
            } else {
                emdrSession.classList.remove('emdr-fullscreen');
                isFullscreen = false;
                updateFullscreenButtons('üì∫ Plein √âcran');
                
                // Redimensionner le canvas
                setTimeout(() => {
                    resizeEMDRCanvas();
                }, 100);
            }
        }

        // Mettre √† jour le texte des boutons plein √©cran
        function updateFullscreenButtons(text) {
            const btn1 = document.getElementById('fullscreen-btn');
            const btn2 = document.getElementById('fullscreen-btn-landscape');
            
            if (btn1) btn1.textContent = text;
            if (btn2) btn2.textContent = text;
        }

        // Notification plein √©cran
        function showFullscreenNotification(message) {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0,0,0,0.9);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                z-index: 10001;
                font-size: 1.1rem;
                text-align: center;
                max-width: 80%;
                animation: fadeIn 0.5s ease;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => notification.remove(), 3000);
        }

        // G√©rer les √©v√©nements de changement de plein √©cran
        document.addEventListener('fullscreenchange', handleFullscreenChange);
        document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
        document.addEventListener('msfullscreenchange', handleFullscreenChange);

        function handleFullscreenChange() {
            const isDocumentFullscreen = !!(document.fullscreenElement || 
                document.webkitFullscreenElement || 
                document.msFullscreenElement);
            
            if (!isDocumentFullscreen && isFullscreen) {
                // L'utilisateur a quitt√© le plein √©cran (ex: touche √âchap)
                exitFullscreen();
            }
        }

        // Raccourci clavier pour plein √©cran (Desktop uniquement)
        document.addEventListener('keydown', (e) => {
            // V√©rifier si on est sur desktop (largeur > 768px)
            if (window.innerWidth > 768 && document.getElementById('emdr-session').classList.contains('active')) {
                if (e.key === 'F11' || (e.key === 'f' || e.key === 'F')) {
                    e.preventDefault();
                    toggleFullscreen();
                }
                
                // √âchap pour quitter (Desktop uniquement)
                if (e.key === 'Escape' && isFullscreen) {
                    exitFullscreen();
                }
            }
        });

        // Adapter les dimensions du canvas selon l'orientation
        function resizeEMDRCanvas() {
            const canvas = document.getElementById('emdr-canvas-portrait');
            if (!canvas) return;
            
            const container = document.querySelector('.emdr-container');
            if (!container) return;
            
            const isFullscreen = container.closest('.emdr-fullscreen') !== null;
            
            if (isFullscreen) {
                // Mode plein √©cran - utiliser TOUTE la surface
                canvas.style.width = '100vw';
                canvas.style.height = '100vh';
                canvas.style.minHeight = '100vh';
                canvas.style.position = 'relative';
                console.log('üì∫ Plein √âcran - Canvas: 100vw x 100vh');
            } else {
                // Mode normal - s'adapter au container
                canvas.style.width = '100%';
                canvas.style.height = '100%';
                canvas.style.position = 'relative';
                const isLandscape = window.innerWidth > window.innerHeight;
                const isMobile = window.innerWidth <= 768;
                
                if (isMobile && isLandscape) {
                    canvas.style.minHeight = '180px';
                    console.log('üì± Mobile Paysage - Canvas: 100% container, min 180px');
                } else if (isMobile) {
                    canvas.style.minHeight = '250px';
                    console.log('üì± Mobile Portrait - Canvas: 100% container, min 250px');
                } else {
                    canvas.style.minHeight = '400px';
                    console.log('üñ•Ô∏è Desktop - Canvas: 100% container, min 400px');
                }
            }
            
            // Forcer un recalcul des dimensions apr√®s 100ms
            setTimeout(() => {
                const newWidth = canvas.offsetWidth;
                const newHeight = canvas.offsetHeight;
                console.log(`üîÑ Canvas redimensionn√©: ${newWidth}x${newHeight}`);
            }, 100);
        }

        // √âcouter les changements d'orientation
        window.addEventListener('orientationchange', () => {
            setTimeout(() => {
                resizeEMDRCanvas();
                console.log('üîÑ Orientation chang√©e - Canvas redimensionn√©');
            }, 100);
        });

        // √âcouter le redimensionnement de fen√™tre
        window.addEventListener('resize', () => {
            resizeEMDRCanvas();
        });

        // ============ FIN SYST√àME PLEIN √âCRAN ============

        // ============ SYST√àME D'ACTIVATION CARTE UNIQUE ============

        // Base de donn√©es des codes valides (en production, ceci serait sur serveur s√©curis√©)
        const VALID_ACTIVATION_CODES = [
            // Format: XXXX-XXXX (premi√®re partie = s√©rie, deuxi√®me = num√©ro unique)
            'PA01-1001', 'PA01-1002', 'PA01-1003', 'PA01-1004', 'PA01-1005',
            'PA01-1006', 'PA01-1007', 'PA01-1008', 'PA01-1009', 'PA01-1010',
            'PA02-2001', 'PA02-2002', 'PA02-2003', 'PA02-2004', 'PA02-2005',
            'PA03-3001', 'PA03-3002', 'PA03-3003', 'PA03-3004', 'PA03-3005',
            // Codes de test (√† retirer en production)
            'TEST-0001', 'DEMO-0001', 'BETA-0001'
        ];

        // IDs NFC des cartes valides (simulation - en r√©alit√© ces IDs viendraient du scan)
        const VALID_NFC_IDS = [
            '04:12:34:56:78:90:AB',
            '04:AB:CD:EF:12:34:56',
            '04:98:76:54:32:10:FE',
            // IDs de test
            'TEST:NFC:001',
            'DEMO:NFC:001'
        ];

        // V√©rifier l'activation au chargement
        function checkActivationStatus() {
            const activated = localStorage.getItem('passAnxiete_activated');
            const activationCode = localStorage.getItem('passAnxiete_activation_code');
            const activationDate = localStorage.getItem('passAnxiete_activation_date');
            
            if (activated === 'true' && activationCode && activationDate) {
                // V√©rifier que l'activation n'est pas trop ancienne (optionnel)
                const activationTime = new Date(activationDate);
                const now = new Date();
                const daysSinceActivation = (now - activationTime) / (1000 * 60 * 60 * 24);
                
                // Si l'activation a plus de 365 jours, demander r√©activation (optionnel)
                if (daysSinceActivation > 365) {
                    showReactivationNeeded();
                    return false;
                }
                
                isActivated = true;
                logActivationAttempt('auto_login', { code: activationCode });
                return true;
            }
            return false;
        }

        // Activation par code
        function activateWithCode() {
            const codeInput = document.getElementById('activation-code');
            const errorDiv = document.getElementById('code-error');
            const btn = document.querySelector('.activation-btn');
            
            const inputCode = codeInput.value.trim().toUpperCase();
            
            // Reset
            hideError(errorDiv);
            
            // Validation
            if (!inputCode) {
                showError(errorDiv, 'Veuillez saisir votre code d\'activation');
                return;
            }
            
            if (inputCode.length < 8) {
                showError(errorDiv, 'Le code doit contenir 8 caract√®res (format XXXX-XXXX)');
                return;
            }
            
            // √âtat de chargement
            btn.disabled = true;
            btn.textContent = 'üîç V√©rification...';
            
            // Simulation d√©lai r√©seau + v√©rification
            setTimeout(() => {
                if (VALID_ACTIVATION_CODES.includes(inputCode)) {
                    // Succ√®s
                    performActivation('code', inputCode);
                } else {
                    // √âchec
                    showError(errorDiv, '‚ùå Code invalide. V√©rifiez votre carte physique.');
                    logActivationAttempt('invalid_code', { attemptedCode: inputCode });
                    
                    // R√©initialiser le bouton
                    btn.disabled = false;
                    btn.textContent = '‚ú® Activer ‚ú®';
                }
            }, 2000);
        }

        // Activation par NFC
        function activateWithNFC() {
            const statusDiv = document.getElementById('nfc-status');
            
            statusDiv.className = 'nfc-status active';
            statusDiv.textContent = 'üì° Recherche de votre carte NFC...';
            
            // V√©rifier si NFC est disponible
            if (!('NDEFReader' in window)) {
                statusDiv.className = 'nfc-status error';
                statusDiv.textContent = '‚ùå NFC non disponible sur cet appareil';
                return;
            }
            
            try {
                const reader = new NDEFReader();
                
                reader.scan().then(() => {
                    statusDiv.textContent = '‚úÖ NFC activ√© - Approchez votre carte...';
                    
                    reader.addEventListener('reading', ({ message, serialNumber }) => {
                        // Simuler la v√©rification de l'ID NFC
                        const nfcId = serialNumber || 'SIMULATED:NFC:' + Date.now();
                        
                        // En production, v√©rifier l'ID contre la base de donn√©es
                        if (VALID_NFC_IDS.includes(nfcId) || nfcId.startsWith('SIMULATED:')) {
                            statusDiv.className = 'nfc-status success';
                            statusDiv.textContent = '‚úÖ Carte reconnue ! Activation...';
                            
                            setTimeout(() => {
                                performActivation('nfc', nfcId);
                            }, 1000);
                        } else {
                            statusDiv.className = 'nfc-status error';
                            statusDiv.textContent = '‚ùå Carte non reconnue';
                            logActivationAttempt('invalid_nfc', { nfcId });
                        }
                    });
                    
                }).catch(error => {
                    statusDiv.className = 'nfc-status error';
                    statusDiv.textContent = '‚ùå Erreur NFC: ' + error.message;
                });
                
            } catch (error) {
                statusDiv.className = 'nfc-status error';
                statusDiv.textContent = '‚ùå Erreur: ' + error.message;
            }
        }

        // Effectuer l'activation r√©ussie (transition directe)
        function performActivation(method, identifier) {
            const activationData = {
                activated: true,
                method: method,
                identifier: identifier,
                timestamp: new Date().toISOString(),
                deviceInfo: {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language
                }
            };
            
            // Sauvegarder l'activation
            localStorage.setItem('passAnxiete_activated', 'true');
            localStorage.setItem('passAnxiete_activation_code', identifier);
            localStorage.setItem('passAnxiete_activation_date', activationData.timestamp);
            localStorage.setItem('passAnxiete_activation_method', method);
            
            // Log l'activation
            logActivationAttempt('successful_activation', activationData);
            
            // Transition directe vers l'application avec animation
            showActivationTransition();
        }

        // Animation de transition d'activation
        function showActivationTransition() {
            const activationScreen = document.getElementById('activation-screen');
            
            // Animation de fondu sortant
            activationScreen.style.transition = 'opacity 0.8s ease, transform 0.8s ease';
            activationScreen.style.opacity = '0';
            activationScreen.style.transform = 'scale(0.95)';
            
            setTimeout(() => {
                isActivated = true;
                goToScreen('home-screen');
                showActivationSuccess();
            }, 800);
        }

        // Afficher le message de succ√®s avec info wake lock
        function showActivationSuccess() {
            // Cr√©er une notification de succ√®s temporaire
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                left: 50%;
                transform: translateX(-50%) translateY(-100%);
                background: linear-gradient(135deg, #4CAF50, #8BC34A);
                color: white;
                padding: 20px 30px;
                border-radius: 15px;
                box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
                z-index: 10000;
                font-weight: 600;
                max-width: 90%;
                text-align: center;
                transition: all 0.5s ease;
                opacity: 0;
            `;
            
            const wakeLockSupported = 'wakeLock' in navigator;
            const wakeLockMessage = wakeLockSupported ? 
                '<br><small style="opacity: 0.9;">üí° L\'√©cran restera allum√© pendant vos sessions th√©rapeutiques</small>' :
                '<br><small style="opacity: 0.9;">‚ö†Ô∏è Ajustez vos param√®tres d\'√©cran pour √©viter la mise en veille</small>';
            
            notification.innerHTML = '‚ú® Bienvenue dans votre Pass Anxi√©t√© Pro !' + wakeLockMessage;
            
            document.body.appendChild(notification);
            
            // Animation d'entr√©e
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(0)';
                notification.style.opacity = '1';
            }, 100);
            
            // Animation de sortie et suppression
            setTimeout(() => {
                notification.style.transform = 'translateX(-50%) translateY(-100%)';
                notification.style.opacity = '0';
                setTimeout(() => notification.remove(), 500);
            }, 5000);
        }

        // Afficher/masquer erreurs
        function showError(element, message) {
            element.textContent = message;
            element.classList.add('show');
        }
        
        function hideError(element) {
            element.classList.remove('show');
        }

        // Logger les tentatives d'activation (pour analytics/s√©curit√©)
        function logActivationAttempt(type, data) {
            const logEntry = {
                type: type,
                timestamp: new Date().toISOString(),
                data: data,
                sessionId: getSessionId()
            };
            
            // Sauvegarder dans localStorage (en production: envoyer au serveur)
            let logs = JSON.parse(localStorage.getItem('passAnxiete_activation_logs') || '[]');
            logs.push(logEntry);
            
            // Garder seulement les 50 derniers logs
            if (logs.length > 50) {
                logs = logs.slice(-50);
            }
            
            localStorage.setItem('passAnxiete_activation_logs', JSON.stringify(logs));
            
            // En production, envoyer au serveur pour monitoring
            // sendToServer('/api/activation-log', logEntry);
        }

        // G√©n√©rer un ID de session unique
        function getSessionId() {
            let sessionId = sessionStorage.getItem('passAnxiete_session_id');
            if (!sessionId) {
                sessionId = 'session_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                sessionStorage.setItem('passAnxiete_session_id', sessionId);
            }
            return sessionId;
        }

        // R√©activation n√©cessaire
        function showReactivationNeeded() {
            alert('‚ö†Ô∏è R√©activation requise\n\nVotre activation a expir√© apr√®s 1 an.\nVeuillez r√©activer votre carte pour continuer.');
            localStorage.removeItem('passAnxiete_activated');
            localStorage.removeItem('passAnxiete_activation_code');
            localStorage.removeItem('passAnxiete_activation_date');
        }

        // Auto-formatage du code d'activation
        function setupActivationInput() {
            const codeInput = document.getElementById('activation-code');
            if (codeInput) {
                codeInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/[^A-Z0-9]/g, '').toUpperCase();
                    
                    // Auto-format avec tiret apr√®s 4 caract√®res
                    if (value.length > 4) {
                        value = value.substring(0, 4) + '-' + value.substring(4, 8);
                    }
                    
                    e.target.value = value;
                });
                
                // Activation avec Enter
                codeInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        activateWithCode();
                    }
                });
            }
        }

        // V√©rifier l'activation avant d'utiliser l'app
        function requireActivation() {
            if (!isActivated) {
                goToScreen('activation-screen');
                return false;
            }
            return true;
        }

        // ============ FIN SYST√àME ACTIVATION ============

        // Tracking clic boutique
        function trackPurchaseClick() {
            logActivationAttempt('purchase_redirect', {
                source: 'activation_screen',
                destination: 'hypnotarot.fr',
                timestamp: new Date().toISOString()
            });
        }

        // Syst√®me de stockage
        class DataManager {
            static saveAnxietyLevel(level) {
                const entry = {
                    level: parseInt(level),
                    timestamp: new Date().toISOString()
                };
                let history = this.getAnxietyHistory();
                history.push(entry);
                localStorage.setItem('anxietyHistory', JSON.stringify(history));
            }

            static getAnxietyHistory() {
                const history = localStorage.getItem('anxietyHistory');
                return history ? JSON.parse(history) : [];
            }

            static logToolUsage(tool) {
                const entry = {
                    tool: tool,
                    timestamp: new Date().toISOString()
                };
                let usage = this.getToolUsage();
                usage.push(entry);
                localStorage.setItem('toolUsage', JSON.stringify(usage));
            }

            static getToolUsage() {
                const usage = localStorage.getItem('toolUsage');
                return usage ? JSON.parse(usage) : [];
            }
        }

        // Questions EMDR
        const EMDR_QUESTIONS = [
            "Que remarquez-vous maintenant ?",
            "Restez concentr√© sur le souvenir...",
            "Quelles pens√©es √©mergent ?",
            "Continuez √† suivre le point des yeux",
            "Que ressentez-vous dans votre corps ?",
            "Laissez venir ce qui vient...",
            "Restez avec l'image du souvenir",
            "Quelles √©motions traversez-vous ?"
        ];

        // Descriptions SUD
        const SUD_DESCRIPTIONS = {
            0: "Aucune d√©tresse - Totalement neutre",
            1: "D√©tresse minimale - Tr√®s l√©g√®re g√™ne", 
            2: "D√©tresse tr√®s l√©g√®re - √Ä peine perceptible",
            3: "D√©tresse l√©g√®re - L√©g√®rement inconfortable",
            4: "D√©tresse mod√©r√©e-l√©g√®re - Commence √† √™tre g√™nant",
            5: "D√©tresse mod√©r√©e - Nettement inconfortable",
            6: "D√©tresse mod√©r√©e-forte - Assez perturbant",
            7: "D√©tresse forte - Tr√®s perturbant",
            8: "D√©tresse tr√®s forte - Difficilement supportable",
            9: "D√©tresse extr√™me - Presque insupportable",
            10: "D√©tresse maximale - La pire possible"
        };

        // D√©tection orientation
        function checkOrientation() {
            return window.innerWidth > window.innerHeight ? 'landscape' : 'portrait';
        }

        function updateSessionDisplay() {
            const orientation = checkOrientation();
            const portraitDiv = document.getElementById('portrait-version');
            const recommendation = document.getElementById('orientation-recommendation');
            
            if (orientation === 'landscape') {
                portraitDiv.style.display = 'block';
                recommendation.classList.remove('show');
                currentMode = 'landscape';
            } else {
                portraitDiv.style.display = 'block';
                if (!recommendationDismissed && document.getElementById('emdr-session').classList.contains('active')) {
                    recommendation.classList.add('show');
                }
                currentMode = 'portrait';
            }
        }

        function hideOrientationRecommendation() {
            recommendationDismissed = true;
            document.getElementById('orientation-recommendation').classList.remove('show');
        }

        // Navigation avec v√©rification d'activation et gestion wake lock
        function goToScreen(screenId) {
            // V√©rifier l'activation avant d'acc√©der aux √©crans prot√©g√©s
            const protectedScreens = ['home-screen', 'crisis-screen', 'emdr-distance', 'breathing-screen', 'tracking-screen', 'tcc-screen'];
            
            if (protectedScreens.includes(screenId) && !requireActivation()) {
                return;
            }
            
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            const screen = document.getElementById(screenId);
            screen.classList.add('active');
            
            // G√©rer le wake lock selon l'√©cran
            manageWakeLockForScreen(screenId);
            
            if (screenId === 'emdr-session') {
                recommendationDismissed = false;
                updateSessionDisplay();
            } else if (screenId === 'tracking-screen') {
                updateTrackingScreen();
            }
        }

        function updateCurrentTime() {
            const now = new Date();
            const timeString = now.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
            const dateString = now.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' });
            const timeElement = document.getElementById('current-time');
            if (timeElement) {
                timeElement.textContent = `${dateString} - ${timeString}`;
            }
        }

        function updateRecommendations() {
            const hour = new Date().getHours();
            let recommendation = '';
            
            if (hour >= 6 && hour < 10) {
                recommendation = '<h4>üåÖ M√©ditation Matinale</h4><p>Commencez votre journ√©e avec calme</p>';
            } else if (hour >= 10 && hour < 14) {
                recommendation = '<h4>üíì Coh√©rence Cardiaque</h4><p>5 minutes pour r√©guler</p>';
            } else if (hour >= 14 && hour < 18) {
                recommendation = '<h4>üëÅÔ∏è EMDR Pro</h4><p>Session de recentrage</p>';
            } else if (hour >= 18 && hour < 22) {
                recommendation = '<h4>üéß Hypnose du Soir</h4><p>Lib√©rez les tensions</p>';
            } else {
                recommendation = '<h4>üí® Respiration Calme</h4><p>Pour faciliter l\'endormissement</p>';
            }
            
            const el = document.getElementById('recommended-tool');
            if (el) el.innerHTML = recommendation;
        }

        // Configuration SUD sliders
        function setupSUDSliders() {
            const sudBefore = document.getElementById('sud-before');
            const sudAfter = document.getElementById('sud-after');
            
            if (sudBefore) {
                sudBefore.addEventListener('input', (e) => {
                    const value = e.target.value;
                    document.getElementById('sud-before-value').textContent = value;
                    document.getElementById('sud-before-desc').textContent = SUD_DESCRIPTIONS[value];
                });
            }
            
            if (sudAfter) {
                sudAfter.addEventListener('input', (e) => {
                    const value = e.target.value;
                    document.getElementById('sud-after-value').textContent = value;
                    document.getElementById('sud-after-desc').textContent = SUD_DESCRIPTIONS[value];
                });
            }
        }

        // Session EMDR professionnelle
        function startEMDRSession() {
            sudBefore = parseInt(document.getElementById('sud-before').value);
            const mode = document.getElementById('emdr-mode').value;
            
            // Redimensionner le canvas avant de commencer
            setTimeout(() => {
                resizeEMDRCanvas();
            }, 100);
            
            switch(mode) {
                case 'professional':
                    totalSeries = 4;
                    emdrTimeRemaining = 120;
                    break;
                case 'quick':
                    totalSeries = 1;
                    emdrTimeRemaining = 120;
                    break;
                case 'standard':
                    totalSeries = 2;
                    emdrTimeRemaining = 150;
                    break;
            }
            
            currentSeries = 1;
            document.getElementById('total-series-portrait').textContent = totalSeries;
            
            goToScreen('emdr-session');
            
            setTimeout(() => {
                startEMDRAnimation();
            }, 3000);
        }

        function startEMDRAnimation() {
            const speed = document.getElementById('emdr-speed').value;
            updateTimer();
            
            const dot = document.getElementById('emdr-dot-portrait');
            const canvas = document.getElementById('emdr-canvas-portrait');
            
            // Dimensions du point lui-m√™me (50px par d√©faut)
            const dotSize = 50;
            const margin = dotSize / 2; // Marge = rayon du point pour qu'il ne sorte pas
            
            let canvasWidth = canvas.offsetWidth;
            let canvasHeight = canvas.offsetHeight;
            let maxPositionX = canvasWidth - margin;
            let minPositionX = margin;
            let position = { x: minPositionX, y: canvasHeight / 2 - (dotSize / 2) };
            let direction = { x: 1, y: 0 };
            
            const speedConfig = { slow: 4000, medium: 2500, fast: 1500 };
            const cycleDuration = speedConfig[speed];
            
            console.log(`üéØ EMDR Setup: Canvas ${canvasWidth}x${canvasHeight}, Point ${dotSize}px, Zone: ${minPositionX} ‚Üí ${maxPositionX}`);
            
            function animate() {
                // Recalculer les dimensions dynamiquement (important pour rotation/plein √©cran)
                canvasWidth = canvas.offsetWidth;
                canvasHeight = canvas.offsetHeight;
                maxPositionX = canvasWidth - margin;
                minPositionX = margin;
                
                // Distance totale √† parcourir
                const totalDistance = maxPositionX - minPositionX;
                const increment = totalDistance / (cycleDuration / 50);
                
                // Mouvement avec v√©rification des limites
                if (direction.x > 0) {
                    // Vers la droite
                    position.x += increment;
                    if (position.x >= maxPositionX) {
                        position.x = maxPositionX;
                        direction.x = -1;
                    }
                } else {
                    // Vers la gauche
                    position.x -= increment;
                    if (position.x <= minPositionX) {
                        position.x = minPositionX;
                        direction.x = 1;
                    }
                }
                
                // Centrage vertical parfait
                position.y = (canvasHeight / 2) - (dotSize / 2);
                
                // Application de la position (en tenant compte que le point est positionn√© par son coin sup√©rieur gauche)
                dot.style.left = (position.x - dotSize / 2) + 'px';
                dot.style.top = position.y + 'px';
                
                // Debug occasionnel
                if (Math.random() < 0.001) { // 1 fois sur 1000
                    console.log(`üéØ Point: ${Math.round(position.x)}px dans canvas ${canvasWidth}px (${Math.round(minPositionX)} ‚Üí ${Math.round(maxPositionX)})`);
                }
            }
            
            // Initialiser la position du point correctement avant de d√©marrer l'animation
            position.x = minPositionX;
            position.y = (canvasHeight / 2) - (dotSize / 2);
            dot.style.left = (position.x - dotSize / 2) + 'px';
            dot.style.top = position.y + 'px';
            
            console.log(`üöÄ Animation EMDR d√©marr√©e: Canvas ${canvasWidth}x${canvasHeight}, Zone ${minPositionX}‚Üí${maxPositionX}`);
            
            emdrInterval = setInterval(animate, 50);
            
            emdrTimerInterval = setInterval(() => {
                emdrTimeRemaining--;
                updateTimer();
                
                if (emdrTimeRemaining <= 0) {
                    stopEMDRAnimation();
                    completeSeries();
                }
            }, 1000);
            
            // Questions th√©rapeutiques
            let questionIndex = 0;
            questionInterval = setInterval(() => {
                showQuestion(EMDR_QUESTIONS[questionIndex % EMDR_QUESTIONS.length]);
                questionIndex++;
            }, 15000);
        }

        function stopEMDRAnimation() {
            if (emdrInterval) clearInterval(emdrInterval);
            if (emdrTimerInterval) clearInterval(emdrTimerInterval);
            if (questionInterval) clearInterval(questionInterval);
        }

        function stopEMDRSession() {
            stopEMDRAnimation();
            if (confirm('Voulez-vous vraiment arr√™ter la session ?\n\nVous pourrez passer √† l\'√©valuation finale.')) {
                DataManager.logToolUsage('emdr');
                goToScreen('emdr-evaluation');
            } else {
                startEMDRAnimation();
            }
        }

        function updateTimer() {
            const minutes = Math.floor(emdrTimeRemaining / 60);
            const seconds = emdrTimeRemaining % 60;
            const timeStr = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            const timer = document.getElementById('session-timer-portrait');
            if (timer) timer.textContent = timeStr;
        }

        function showQuestion(question) {
            const overlay = document.getElementById('question-overlay');
            document.getElementById('question-text').textContent = question;
            overlay.classList.add('visible');
            
            setTimeout(() => {
                overlay.classList.remove('visible');
            }, 4000);
        }

        function completeSeries() {
            if (currentSeries >= totalSeries) {
                DataManager.logToolUsage('emdr');
                goToScreen('emdr-evaluation');
            } else {
                if (confirm(`S√©rie ${currentSeries}/${totalSeries} termin√©e.\n\nQue remarquez-vous ?\n- Nouvelles pens√©es ?\n- √âmotions diff√©rentes ?\n- Sensations corporelles ?\n\nContinuer avec la s√©rie ${currentSeries + 1} ?`)) {
                    currentSeries++;
                    document.getElementById('current-series-portrait').textContent = currentSeries;
                    
                    const mode = document.getElementById('emdr-mode').value;
                    switch(mode) {
                        case 'professional':
                            emdrTimeRemaining = 120;
                            break;
                        case 'standard':
                            emdrTimeRemaining = 150;
                            break;
                    }
                    
                    startEMDRAnimation();
                } else {
                    DataManager.logToolUsage('emdr');
                    goToScreen('emdr-evaluation');
                }
            }
        }

        // √âvaluation EMDR
        function evaluateResults() {
            sudAfter = parseInt(document.getElementById('sud-after').value);
            
            document.getElementById('comparison-section').style.display = 'block';
            
            const heightBefore = (sudBefore / 10) * 100;
            const heightAfter = (sudAfter / 10) * 100;
            
            document.getElementById('bar-before').style.height = heightBefore + '%';
            document.getElementById('bar-before').textContent = sudBefore;
            
            document.getElementById('bar-after').style.height = heightAfter + '%';
            document.getElementById('bar-after').textContent = sudAfter;
            
            const improvement = sudBefore - sudAfter;
            const improvementPercent = ((improvement / sudBefore) * 100).toFixed(0);
            
            const resultMsg = document.getElementById('result-message');
            const interpretation = document.getElementById('interpretation-text');
            
            if (sudAfter <= 2) {
                resultMsg.className = 'result-message success';
                resultMsg.innerHTML = `
                    <strong>‚úÖ Excellent r√©sultat !</strong><br>
                    Am√©lioration de ${improvement} points (-${improvementPercent}%)<br>
                    Le souvenir est maintenant faiblement perturbant.
                `;
                interpretation.innerHTML = `
                    <strong>Retraitement r√©ussi !</strong><br>
                    Votre cerveau a int√©gr√© l'information √©motionnelle. Le souvenir reste accessible mais n'est plus charg√© √©motionnellement.<br><br>
                    <strong>Recommandation :</strong> Le travail sur cette cible est termin√©.
                `;
            } else if (improvement >= 3) {
                resultMsg.className = 'result-message success';
                resultMsg.innerHTML = `
                    <strong>üëç Bonne am√©lioration !</strong><br>
                    Am√©lioration de ${improvement} points (-${improvementPercent}%)<br>
                    Le retraitement a bien commenc√©.
                `;
                interpretation.innerHTML = `
                    <strong>Progr√®s significatif</strong><br>
                    Le retraitement est en cours. Plusieurs s√©ries suppl√©mentaires pourraient √™tre b√©n√©fiques.<br><br>
                    <strong>Recommandation :</strong> Refaire une session EMDR sur la m√™me cible dans les prochains jours.
                `;
            } else {
                resultMsg.className = 'result-message warning';
                resultMsg.innerHTML = `
                    <strong>‚ö†Ô∏è Am√©lioration l√©g√®re</strong><br>
                    Am√©lioration de ${improvement} point(s)<br>
                    Le retraitement n√©cessite plus de travail.
                `;
                interpretation.innerHTML = `
                    <strong>Retraitement incomplet</strong><br>
                    Le souvenir n√©cessite plus de s√©ries de stimulation bilat√©rale.<br><br>
                    <strong>Recommandation :</strong> Consulter un th√©rapeute EMDR certifi√© pour un accompagnement professionnel.
                `;
            }
            
            document.getElementById('comparison-section').scrollIntoView({ behavior: 'smooth' });
        }

        // EMDR Simple
        function startSimpleEMDR() {
            const speed = document.getElementById('emdr-speed-simple').value;
            const duration = parseInt(document.getElementById('emdr-duration-simple').value);
            
            const speedConfig = { slow: 4000, medium: 2500, fast: 1500 };
            const cycleDuration = speedConfig[speed];
            
            emdrTimeRemaining = duration * 60;
            updateSimpleEMDRTimer();
            
            const dot = document.getElementById('emdr-dot');
            const canvas = document.getElementById('emdr-canvas');
            const canvasWidth = canvas.offsetWidth;
            const dotWidth = dot.offsetWidth;
            const maxPosition = canvasWidth - dotWidth;
            
            let position = 0;
            let direction = 1;
            
            function animate() {
                const increment = maxPosition / (cycleDuration / 50);
                position += increment * direction;
                
                if (position >= maxPosition) {
                    position = maxPosition;
                    direction = -1;
                } else if (position <= 0) {
                    position = 0;
                    direction = 1;
                }
                
                dot.style.left = position + 'px';
            }
            
            emdrInterval = setInterval(animate, 50);
            
            emdrTimerInterval = setInterval(() => {
                emdrTimeRemaining--;
                updateSimpleEMDRTimer();
                
                if (emdrTimeRemaining <= 0) {
                    stopSimpleEMDR();
                    DataManager.logToolUsage('emdr');
                    alert('‚ú® Session EMDR termin√©e ! Bravo !');
                }
            }, 1000);
            
            document.getElementById('emdr-start').style.display = 'none';
            document.getElementById('emdr-stop').style.display = 'inline-block';
        }

        function stopSimpleEMDR() {
            if (emdrInterval) clearInterval(emdrInterval);
            if (emdrTimerInterval) clearInterval(emdrTimerInterval);
            
            document.getElementById('emdr-dot').style.left = '0px';
            document.getElementById('emdr-start').style.display = 'inline-block';
            document.getElementById('emdr-stop').style.display = 'none';
            
            const duration = parseInt(document.getElementById('emdr-duration-simple').value);
            emdrTimeRemaining = duration * 60;
            updateSimpleEMDRTimer();
        }

        function updateSimpleEMDRTimer() {
            const minutes = Math.floor(emdrTimeRemaining / 60);
            const seconds = emdrTimeRemaining % 60;
            document.getElementById('emdr-timer').textContent = 
                `${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        // Respiration
        function startBreathing() {
            breathingCycles = 0;
            updateCycleCounter();
            
            const circle = document.getElementById('breathing-circle');
            const instruction = document.getElementById('breathing-instruction');
            
            function breatheCycle() {
                instruction.textContent = 'Inspirez... üå¨Ô∏è';
                circle.style.transform = 'scale(2)';
                
                setTimeout(() => {
                    instruction.textContent = 'Expirez... üí®';
                    circle.style.transform = 'scale(1)';
                    
                    breathingCycles++;
                    updateCycleCounter();
                    
                    if (breathingCycles >= 30) {
                        setTimeout(() => {
                            stopBreathing();
                            DataManager.logToolUsage('breathing');
                            alert('üéâ Session termin√©e ! Bravo !');
                        }, 5000);
                    }
                }, 5000);
            }
            
            breatheCycle();
            breathingInterval = setInterval(breatheCycle, 10000);
            
            document.getElementById('breathing-start').style.display = 'none';
            document.getElementById('breathing-stop').style.display = 'inline-block';
        }

        function stopBreathing() {
            if (breathingInterval) clearInterval(breathingInterval);
            
            document.getElementById('breathing-circle').style.transform = 'scale(1)';
            document.getElementById('breathing-instruction').textContent = 'Pr√™t √† commencer';
            
            document.getElementById('breathing-start').style.display = 'inline-block';
            document.getElementById('breathing-stop').style.display = 'none';
            
            breathingCycles = 0;
            updateCycleCounter();
        }

        function updateCycleCounter() {
            document.getElementById('cycle-count').textContent = breathingCycles;
        }

        // Suivi
        function updateTrackingScreen() {
            const usage = DataManager.getToolUsage();
            const anxiety = DataManager.getAnxietyHistory();
            
            const totalSessions = usage.length;
            
            const toolCounts = {};
            usage.forEach(e => {
                toolCounts[e.tool] = (toolCounts[e.tool] || 0) + 1;
            });
            const favTool = Object.keys(toolCounts).reduce((a, b) => 
                toolCounts[a] > toolCounts[b] ? a : b, '');
            
            const avgAnxiety = anxiety.length > 0 ?
                (anxiety.reduce((sum, e) => sum + e.level, 0) / anxiety.length).toFixed(1) : 0;
            
            // S√©rie cons√©cutive
            const today = new Date().toISOString().split('T')[0];
            const uniqueDates = [...new Set(usage.map(e => 
                new Date(e.timestamp).toISOString().split('T')[0]
            ))].sort().reverse();
            
            let streak = 0;
            for (let i = 0; i < uniqueDates.length; i++) {
                const expectedDate = new Date();
                expectedDate.setDate(expectedDate.getDate() - i);
                const expectedDateStr = expectedDate.toISOString().split('T')[0];
                
                if (uniqueDates[i] === expectedDateStr) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('total-sessions').textContent = totalSessions;
            
            const toolNames = {
                'emdr': 'EMDR',
                'breathing': 'Respiration',
                'crisis': 'Mode Crise'
            };
            document.getElementById('favorite-tool').textContent = 
                toolNames[favTool] || '-';
            
            document.getElementById('avg-anxiety').textContent = 
                avgAnxiety > 0 ? avgAnxiety + '/10' : '-';
            
            document.getElementById('streak-days').textContent = streak;
        }

        // Initialisation
        document.addEventListener('DOMContentLoaded', () => {
            // D'abord masquer TOUS les √©crans
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            
            // V√©rifier l'activation en premier
            if (checkActivationStatus()) {
                // D√©j√† activ√©, aller directement √† l'accueil
                goToScreen('home-screen');
            } else {
                // Pas activ√©, afficher UNIQUEMENT l'√©cran d'activation
                document.getElementById('activation-screen').classList.add('active');
            }
            
            // Configuration du syst√®me d'activation
            setupActivationInput();
            
            updateCurrentTime();
            setInterval(updateCurrentTime, 60000);
            updateRecommendations();
            
            // Redimensionner le canvas EMDR au chargement
            setTimeout(() => {
                resizeEMDRCanvas();
                
                // Afficher l'indication clavier uniquement sur desktop
                if (window.innerWidth > 768) {
                    const keyboardHint = document.getElementById('keyboard-hint');
                    if (keyboardHint) {
                        keyboardHint.style.display = 'inline';
                    }
                }
            }, 500);
            
            // Nettoyage wake lock √† la fermeture
            window.addEventListener('beforeunload', () => {
                releaseWakeLock();
            });
            
            // Afficher un indicateur si wake lock est actif
            if ('wakeLock' in navigator) {
                console.log('‚úÖ Wake Lock API disponible - L\'√©cran restera allum√© pendant les sessions');
            } else {
                console.log('‚ö†Ô∏è Wake Lock API non disponible - L\'√©cran peut s\'√©teindre pendant les sessions');
            }
            
            // Skip NFC (maintenant d√©sactiv√© par d√©faut)
            const skipNfc = document.getElementById('skip-nfc');
            if (skipNfc) {
                skipNfc.addEventListener('click', () => {
                    if (requireActivation()) {
                        goToScreen('home-screen');
                    }
                });
            }
            
            // Navigation outils
            document.querySelectorAll('.tool-card').forEach(card => {
                card.addEventListener('click', () => {
                    const tool = card.dataset.tool;
                    const screenMap = {
                        'crisis': 'crisis-screen',
                        'emdr': 'emdr-distance',
                        'breathing': 'breathing-screen',
                        'tracking': 'tracking-screen',
                        'tcc': 'tcc-screen',
                        'thoughts': 'thoughts-screen',
                        'emotions': 'emotions-screen',
                        'journal': 'journal-screen',
                        'techniques': 'techniques-screen',
                        'thoughts-history': 'thoughts-history-screen'
                    };
                    if (screenMap[tool]) {
                        goToScreen(screenMap[tool]);
                    } else {
                        alert('Cette fonctionnalit√© sera bient√¥t disponible !');
                    }
                });
            });
            
            // Boutons retour
            document.querySelectorAll('[data-back]').forEach(btn => {
                btn.addEventListener('click', () => {
                    goToScreen(btn.dataset.back);
                });
            });
            
            // Boutons urgence
            document.querySelectorAll('[data-emergency]').forEach(btn => {
                btn.addEventListener('click', () => {
                    const tool = btn.dataset.emergency;
                    if (tool === 'breathing') {
                        goToScreen('breathing-screen');
                    } else if (tool === 'emdr') {
                        // Rediriger vers EMDR Pro complet au lieu d'EMDR simple
                        goToScreen('emdr-distance');
                    }
                });
            });
            
            // Jauge anxi√©t√©
            document.getElementById('anxiety-level').addEventListener('input', (e) => {
                const value = e.target.value;
                document.getElementById('anxiety-display').textContent = value;
                DataManager.saveAnxietyLevel(value);
            });
            
            // EMDR Simple
            const emdrStartBtn = document.getElementById('emdr-start');
            const emdrStopBtn = document.getElementById('emdr-stop');
            
            if (emdrStartBtn) {
                emdrStartBtn.addEventListener('click', startSimpleEMDR);
            }
            if (emdrStopBtn) {
                emdrStopBtn.addEventListener('click', stopSimpleEMDR);
            }
            
            // Respiration
            document.getElementById('breathing-start').addEventListener('click', startBreathing);
            document.getElementById('breathing-stop').addEventListener('click', stopBreathing);
            
            // Configuration SUD sliders
            setupSUDSliders();
            
            // Configuration TCC
            setupTCCComponents();
            
            // √âcouteurs d'orientation
            window.addEventListener('resize', () => {
                if (document.getElementById('emdr-session').classList.contains('active')) {
                    updateSessionDisplay();
                }
            });

            window.addEventListener('orientationchange', () => {
                if (document.getElementById('emdr-session').classList.contains('active')) {
                    setTimeout(updateSessionDisplay, 100);
                }
            });
        });

        // ============ FONCTIONS TCC ============

        // Configuration des composants TCC
        function setupTCCComponents() {
            // Date actuelle pour le journal
            const currentDateEl = document.getElementById('current-date');
            if (currentDateEl) {
                currentDateEl.textContent = new Date().toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric'
                });
            }

            // Slider humeur quotidienne
            const moodSlider = document.getElementById('daily-mood');
            if (moodSlider) {
                moodSlider.addEventListener('input', (e) => {
                    document.getElementById('mood-value').textContent = e.target.value;
                });
            }

            // Boutons √©motions
            document.querySelectorAll('.emotion-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    // D√©s√©lectionner tous les autres
                    document.querySelectorAll('.emotion-btn').forEach(b => b.classList.remove('selected'));
                    // S√©lectionner celui-ci
                    btn.classList.add('selected');
                    
                    const emotion = btn.dataset.emotion;
                    document.getElementById('selected-emotion').textContent = emotion.charAt(0).toUpperCase() + emotion.slice(1);
                    
                    // Afficher la section intensit√©
                    document.getElementById('emotion-intensity-section').style.display = 'block';
                });
            });

            // Slider intensit√© √©motion
            const emotionIntensity = document.getElementById('emotion-intensity');
            if (emotionIntensity) {
                emotionIntensity.addEventListener('input', (e) => {
                    document.getElementById('emotion-intensity-value').textContent = e.target.value;
                });
            }
        }

        // Sauvegarder exercice de pens√©es (limit√© √† 10)
        function saveThoughtExercise() {
            const currentThought = document.getElementById('current-thought').value;
            const alternativeThought = document.getElementById('alternative-thought').value;
            
            if (!currentThought.trim()) {
                alert('Veuillez d\'abord d√©crire votre pens√©e n√©gative');
                return;
            }

            const exercise = {
                type: 'thought-exercise',
                date: new Date().toISOString(),
                currentThought: currentThought,
                alternativeThought: alternativeThought,
                id: 'thought_' + Date.now()
            };

            // R√©cup√©rer les exercices existants
            let exercises = JSON.parse(localStorage.getItem('tccThoughtExercises') || '[]');
            
            // Ajouter le nouvel exercice au d√©but
            exercises.unshift(exercise);
            
            // Limiter √† 10 exercices maximum
            if (exercises.length > 10) {
                exercises = exercises.slice(0, 10);
            }
            
            // Sauvegarder
            localStorage.setItem('tccThoughtExercises', JSON.stringify(exercises));

            // Log pour le suivi g√©n√©ral
            DataManager.logToolUsage('tcc-thoughts');

            alert('‚úÖ Exercice sauvegard√© ! Bien jou√© pour ce travail sur vos pens√©es.\n\nüí° Vous pouvez revoir vos exercices dans l\'historique.');
            
            // R√©initialiser le formulaire
            document.getElementById('current-thought').value = '';
            document.getElementById('alternative-thought').value = '';
        }

        // Afficher l'historique des exercices de pens√©es
        function showThoughtHistory() {
            goToScreen('thoughts-history-screen');
            displayThoughtHistory();
        }

        // Afficher la liste des exercices de pens√©es
        function displayThoughtHistory() {
            const historyList = document.getElementById('thoughts-history-list');
            const exercises = JSON.parse(localStorage.getItem('tccThoughtExercises') || '[]');
            
            if (exercises.length === 0) {
                historyList.innerHTML = `
                    <div class="thoughts-empty">
                        <div class="thoughts-empty-icon">üí≠</div>
                        <h3>Aucun exercice sauvegard√©</h3>
                        <p>Commencez par faire un exercice de restructuration cognitive pour le voir appara√Ætre ici.</p>
                    </div>
                `;
                return;
            }

            historyList.innerHTML = exercises.map((exercise, index) => {
                const date = new Date(exercise.date);
                const dateStr = date.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                return `
                    <div class="thought-history-item" data-id="${exercise.id}">
                        <div class="thought-history-header">
                            <div class="thought-date">üìÖ ${dateStr}</div>
                            <div class="thought-actions">
                                <button class="thought-action-btn" onclick="reuseThought('${exercise.id}')">
                                    üîÑ R√©utiliser
                                </button>
                                <button class="thought-action-btn delete" onclick="deleteThought('${exercise.id}')">
                                    üóëÔ∏è Supprimer
                                </button>
                            </div>
                        </div>
                        
                        <div class="thought-content">
                            <div class="thought-section">
                                <div class="thought-section-title">üí≠ Pens√©e n√©gative :</div>
                                <div class="thought-section-content">
                                    ${exercise.currentThought || 'Non renseign√©'}
                                </div>
                            </div>
                            
                            ${exercise.alternativeThought ? `
                                <div class="thought-section">
                                    <div class="thought-section-title">‚ú® Pens√©e alternative :</div>
                                    <div class="thought-section-content alternative">
                                        ${exercise.alternativeThought}
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // R√©utiliser un exercice de pens√©e
        function reuseThought(thoughtId) {
            const exercises = JSON.parse(localStorage.getItem('tccThoughtExercises') || '[]');
            const exercise = exercises.find(ex => ex.id === thoughtId);
            
            if (exercise) {
                // Aller √† l'√©cran d'exercice et pr√©-remplir
                goToScreen('thoughts-screen');
                
                setTimeout(() => {
                    document.getElementById('current-thought').value = exercise.currentThought || '';
                    document.getElementById('alternative-thought').value = exercise.alternativeThought || '';
                    
                    // Scroll vers le haut pour voir les champs
                    document.getElementById('current-thought').scrollIntoView({ 
                        behavior: 'smooth', 
                        block: 'center' 
                    });
                }, 100);
                
                alert('üí° Exercice recharg√© ! Vous pouvez le modifier et le sauvegarder √† nouveau.');
            }
        }

        // Supprimer un exercice de pens√©e
        function deleteThought(thoughtId) {
            if (confirm('√ätes-vous s√ªr de vouloir supprimer cet exercice ?')) {
                let exercises = JSON.parse(localStorage.getItem('tccThoughtExercises') || '[]');
                exercises = exercises.filter(ex => ex.id !== thoughtId);
                localStorage.setItem('tccThoughtExercises', JSON.stringify(exercises));
                
                // Rafra√Æchir l'affichage
                displayThoughtHistory();
                
                alert('üóëÔ∏è Exercice supprim√©.');
            }
        }

        // Exporter les exercices de pens√©es
        function exportThoughts() {
            const exercises = JSON.parse(localStorage.getItem('tccThoughtExercises') || '[]');
            
            if (exercises.length === 0) {
                alert('Aucun exercice √† exporter.');
                return;
            }

            // Cr√©er le contenu texte
            let content = '# üí≠ Mes Exercices de Pens√©es - Pass Anxi√©t√©\n\n';
            content += `Export√© le : ${new Date().toLocaleDateString('fr-FR')}\n`;
            content += `Nombre d'exercices : ${exercises.length}\n\n`;
            content += '---\n\n';

            exercises.forEach((exercise, index) => {
                const date = new Date(exercise.date);
                const dateStr = date.toLocaleDateString('fr-FR', {
                    weekday: 'long',
                    day: 'numeric',
                    month: 'long',
                    year: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                content += `## Exercice ${index + 1} - ${dateStr}\n\n`;
                content += `**üí≠ Pens√©e n√©gative :**\n${exercise.currentThought}\n\n`;
                
                if (exercise.alternativeThought) {
                    content += `**‚ú® Pens√©e alternative :**\n${exercise.alternativeThought}\n\n`;
                }
                
                content += '---\n\n';
            });

            // Cr√©er et t√©l√©charger le fichier
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `exercices-pensees-${new Date().toISOString().split('T')[0]}.txt`;
            a.click();
            URL.revokeObjectURL(url);

            alert('üì§ Exercices export√©s ! Le fichier a √©t√© t√©l√©charg√©.');
        }

        // Effacer tout l'historique des pens√©es
        function clearThoughtsHistory() {
            if (confirm('‚ö†Ô∏è Attention !\n\n√ätes-vous s√ªr de vouloir supprimer TOUS vos exercices de pens√©es ?\n\nCette action est irr√©versible.')) {
                localStorage.removeItem('tccThoughtExercises');
                displayThoughtHistory();
                alert('üóëÔ∏è Historique effac√©.');
            }
        }

        // Sauvegarder exercice d'√©motions
        function saveEmotionExercise() {
            const selectedEmotion = document.querySelector('.emotion-btn.selected');
            if (!selectedEmotion) {
                alert('Veuillez d\'abord s√©lectionner une √©motion');
                return;
            }

            const exercise = {
                type: 'emotion-exercise',
                date: new Date().toISOString(),
                emotion: selectedEmotion.dataset.emotion,
                intensity: document.getElementById('emotion-intensity').value,
                trigger: document.getElementById('emotion-trigger').value,
                bodyLocation: document.getElementById('emotion-body').value
            };

            // Sauvegarder
            let exercises = JSON.parse(localStorage.getItem('tccExercises') || '[]');
            exercises.push(exercise);
            localStorage.setItem('tccExercises', JSON.stringify(exercises));

            DataManager.logToolUsage('tcc-emotions');

            alert('‚úÖ Analyse √©motionnelle sauvegard√©e ! Vous progressez dans la compr√©hension de vos √©motions.');
            
            // R√©initialiser
            document.querySelectorAll('.emotion-btn').forEach(b => b.classList.remove('selected'));
            document.getElementById('emotion-intensity-section').style.display = 'none';
            document.getElementById('emotion-trigger').value = '';
            document.getElementById('emotion-body').value = '';
        }

        // Sauvegarder entr√©e de journal
        function saveJournalEntry() {
            const entry = {
                type: 'journal-entry',
                date: new Date().toISOString(),
                mood: document.getElementById('daily-mood').value,
                thoughts: document.getElementById('daily-thoughts').value,
                emotions: document.getElementById('daily-emotions').value,
                triggers: document.getElementById('daily-triggers').value,
                strategies: document.getElementById('daily-strategies').value,
                positives: document.getElementById('daily-positives').value,
                goal: document.getElementById('daily-goal').value
            };

            // V√©rifier qu'au moins un champ est rempli
            const hasContent = Object.values(entry).some(value => 
                typeof value === 'string' && value.trim() !== ''
            );

            if (!hasContent) {
                alert('Veuillez remplir au moins une section de votre journal');
                return;
            }

            // Sauvegarder
            let journal = JSON.parse(localStorage.getItem('tccJournal') || '[]');
            
            // V√©rifier s'il y a d√©j√† une entr√©e pour aujourd'hui
            const today = new Date().toISOString().split('T')[0];
            const existingIndex = journal.findIndex(entry => 
                entry.date.split('T')[0] === today
            );

            if (existingIndex >= 0) {
                // Mettre √† jour l'entr√©e existante
                journal[existingIndex] = entry;
                alert('‚úÖ Entr√©e du jour mise √† jour !');
            } else {
                // Nouvelle entr√©e
                journal.push(entry);
                alert('‚úÖ Nouvelle entr√©e de journal sauvegard√©e !');
            }

            localStorage.setItem('tccJournal', JSON.stringify(journal));
            DataManager.logToolUsage('tcc-journal');

            // R√©initialiser le formulaire
            document.getElementById('daily-mood').value = '5';
            document.getElementById('mood-value').textContent = '5';
            document.querySelectorAll('#journal-screen textarea').forEach(textarea => {
                textarea.value = '';
            });
        }

        // Afficher l'historique du journal
        function showJournalHistory() {
            const historySection = document.getElementById('journal-history');
            const entriesList = document.getElementById('journal-entries-list');
            
            const journal = JSON.parse(localStorage.getItem('tccJournal') || '[]');
            
            if (journal.length === 0) {
                entriesList.innerHTML = '<p style="text-align: center; color: #666;">Aucune entr√©e pour le moment.</p>';
            } else {
                entriesList.innerHTML = journal
                    .sort((a, b) => new Date(b.date) - new Date(a.date))
                    .slice(0, 10) // Derni√®res 10 entr√©es
                    .map(entry => {
                        const date = new Date(entry.date);
                        const dateStr = date.toLocaleDateString('fr-FR', {
                            weekday: 'long',
                            day: 'numeric',
                            month: 'long'
                        });
                        
                        const moodEmoji = entry.mood <= 3 ? 'üòî' : 
                                         entry.mood <= 6 ? 'üòê' : 'üòä';
                        
                        return `
                            <div class="journal-entry-item">
                                <div class="journal-entry-header">
                                    <span>${dateStr}</span>
                                    <span class="journal-entry-mood">${moodEmoji} ${entry.mood}/10</span>
                                </div>
                                <p><strong>Pens√©es :</strong> ${entry.thoughts.substring(0, 100)}${entry.thoughts.length > 100 ? '...' : ''}</p>
                                <p><strong>Points positifs :</strong> ${entry.positives.substring(0, 100)}${entry.positives.length > 100 ? '...' : ''}</p>
                            </div>
                        `;
                    }).join('');
            }
            
            historySection.style.display = historySection.style.display === 'none' ? 'block' : 'none';
        }

        // ========== TECHNIQUES PRATIQUES ==========

        // Technique 5-4-3-2-1 (Grounding)
        function startGroundingTechnique() {
            showTechniqueOverlay(`
                <h2>üî¢ Technique 5-4-3-2-1</h2>
                <p><strong>Pour vous ancrer dans le pr√©sent :</strong></p>
                <p>üîç <strong>5 choses</strong> que vous VOYEZ autour de vous</p>
                <p>üëÇ <strong>4 choses</strong> que vous ENTENDEZ</p>
                <p>‚úã <strong>3 choses</strong> que vous TOUCHEZ</p>
                <p>üëÉ <strong>2 choses</strong> que vous SENTEZ</p>
                <p>üëÖ <strong>1 chose</strong> que vous GO√õTEZ</p>
                <p style="margin-top: 30px; font-size: 1rem; opacity: 0.8;">
                    Prenez votre temps pour chaque √©tape. Cette technique vous ram√®ne dans l'instant pr√©sent.
                </p>
            `);
            DataManager.logToolUsage('tcc-grounding');
        }

        // Dialogue avec ses pens√©es
        function startThoughtDialogue() {
            showTechniqueOverlay(`
                <h2>üé≠ Dialogue avec vos Pens√©es</h2>
                <p><strong>Questionnez votre pens√©e n√©gative :</strong></p>
                <p>‚ùì "Est-ce que c'est vraiment vrai ?"</p>
                <p>üîç "Quelles preuves ai-je pour et contre ?"</p>
                <p>ü§ù "Que dirais-je √† un ami dans cette situation ?"</p>
                <p>üîÆ "Quelle est la probabilit√© que le pire arrive ?"</p>
                <p>üõ†Ô∏è "Comment puis-je agir de mani√®re constructive ?"</p>
                <p style="margin-top: 30px; font-size: 1rem; opacity: 0.8;">
                    Vos pens√©es ne sont pas des faits. Questionnez-les avec bienveillance.
                </p>
            `);
            DataManager.logToolUsage('tcc-dialogue');
        }

        // Afficher overlay technique
        function showTechniqueOverlay(content) {
            const overlay = document.createElement('div');
            overlay.className = 'technique-overlay visible';
            overlay.innerHTML = `
                <div class="technique-content">
                    <button class="technique-close" onclick="this.parentElement.parentElement.remove()">√ó</button>
                    ${content}
                    <button class="btn-primary" style="margin-top: 30px; width: auto;" onclick="this.parentElement.parentElement.remove()">
                        ‚úÖ J'ai termin√©
                    </button>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        // Exercices rapides
        function startGroundingExercise() {
            startGroundingTechnique();
        }

        function startBodyScanExercise() {
            showTechniqueOverlay(`
                <h2>üßò Scan Corporel Rapide</h2>
                <p><strong>Concentrez-vous sur votre corps :</strong></p>
                <p>üß† Commencez par le sommet de votre t√™te</p>
                <p>üëÄ Descendez vers vos yeux, votre visage</p>
                <p>üí™ Vos √©paules, vos bras</p>
                <p>‚ù§Ô∏è Votre poitrine, votre respiration</p>
                <p>ü§≤ Votre ventre, vos hanches</p>
                <p>ü¶µ Vos jambes, vos pieds</p>
                <p style="margin-top: 20px;">
                    O√π ressentez-vous des tensions ? Respirez dans ces zones et rel√¢chez.
                </p>
            `);
            DataManager.logToolUsage('tcc-bodyscan');
        }

        function startDistanceExercise() {
            showTechniqueOverlay(`
                <h2>üåÖ Prise de Distance</h2>
                <p><strong>Imaginez-vous dans 5 ans :</strong></p>
                <p>üîÆ Cette situation sera-t-elle encore importante ?</p>
                <p>üé≠ Si vous √©tiez un observateur externe, que penseriez-vous ?</p>
                <p>üìè Sur une √©chelle de 1 √† 10, quelle est l'importance r√©elle de ce probl√®me ?</p>
                <p>üåä Imaginez vos √©motions comme des vagues : elles montent et redescendent.</p>
                <p style="margin-top: 20px;">
                    Le recul temporel aide √† relativiser nos pr√©occupations.
                </p>
            `);
            DataManager.logToolUsage('tcc-distance');
        }

        function startAcceptanceExercise() {
            showTechniqueOverlay(`
                <h2>ü§ó Acceptation √âmotionnelle</h2>
                <p><strong>Accueillez votre √©motion :</strong></p>
                <p>üëã "Bonjour [nom de l'√©motion], je te vois"</p>
                <p>üéØ "Tu es l√† pour me prot√©ger, merci"</p>
                <p>üåä "Tu peux rester, mais tu n'as pas besoin de me contr√¥ler"</p>
                <p>üíù "J'accepte de ressentir cela sans me juger"</p>
                <p style="margin-top: 20px;">
                    R√©sister aux √©motions les amplifie. Les accueillir les apaise.
                </p>
            `);
            DataManager.logToolUsage('tcc-acceptance');
        }

        function startActivityExercise() {
            const activities = [
                "‚òï Boire une boisson chaude en pleine conscience",
                "üéµ √âcouter votre musique pr√©f√©r√©e",
                "üì± Appeler quelqu'un qui vous fait du bien",
                "üö∂ Faire une courte promenade",
                "üé® Dessiner ou colorier",
                "üìö Lire quelques pages d'un livre",
                "üßò M√©diter 5 minutes",
                "üõÅ Prendre un bain ou une douche relaxante"
            ];
            
            const randomActivity = activities[Math.floor(Math.random() * activities.length)];
            
            showTechniqueOverlay(`
                <h2>üéØ Activit√© Plaisante</h2>
                <p><strong>Suggestion personnalis√©e :</strong></p>
                <p style="font-size: 1.4rem; color: var(--primary); margin: 20px 0;">
                    ${randomActivity}
                </p>
                <p>Cette activit√© peut vous aider √† changer votre √©tat √©motionnel.</p>
                <button class="btn-secondary" style="margin-top: 20px; width: auto;" onclick="startActivityExercise()">
                    üîÑ Autre suggestion
                </button>
            `);
            DataManager.logToolUsage('tcc-activity');
        }

        function startMovementExercise() {
            showTechniqueOverlay(`
                <h2>üèÉ Mouvement Physique</h2>
                <p><strong>Bougez pour lib√©rer les tensions :</strong></p>
                <p>ü§∏ √âtirements doux (bras, cou, dos)</p>
                <p>üö∂ Marche de 5-10 minutes</p>
                <p>üíÉ Danse sur votre musique pr√©f√©r√©e</p>
                <p>üßò Yoga ou tai-chi</p>
                <p>üëä Exercices de boxe dans le vide</p>
                <p style="margin-top: 20px;">
                    Le mouvement lib√®re les endorphines et √©vacue le stress physique.
                </p>
            `);
            DataManager.logToolUsage('tcc-movement');
        }

        function startSocialExercise() {
            showTechniqueOverlay(`
                <h2>üë• Contact Social</h2>
                <p><strong>Connectez-vous avec les autres :</strong></p>
                <p>üìû Appelez un proche</p>
                <p>üí¨ Envoyez un message positif √† quelqu'un</p>
                <p>ü§ó Demandez un c√¢lin</p>
                <p>üëÇ Partagez ce que vous ressentez</p>
                <p>‚ù§Ô∏è Exprimez votre gratitude √† quelqu'un</p>
                <p style="margin-top: 20px;">
                    Le soutien social est l'un des meilleurs rem√®des contre l'anxi√©t√©.
                </p>
            `);
            DataManager.logToolUsage('tcc-social');
        }

        // Fonctions pour les techniques avanc√©es
        function showEmotionChart() {
            alert('üìä Fonctionnalit√© en d√©veloppement !\n\nLe graphique √©motionnel permettra de visualiser l\'√©volution de vos √©motions sur plusieurs semaines.');
        }

        function createCrisisPlan() {
            alert('‚ö° Fonctionnalit√© en d√©veloppement !\n\nLe plan anti-crise vous permettra de cr√©er une strat√©gie personnalis√©e pour les moments difficiles.');
        }

        function startExposureExercise() {
            alert('üéØ Fonctionnalit√© en d√©veloppement !\n\nL\'exposition graduelle vous aidera √† affronter progressivement vos peurs.');
        }

        function showSuccessJournal() {
            alert('üèÜ Fonctionnalit√© en d√©veloppement !\n\nLe journal des r√©ussites valorisera vos progr√®s et accomplissements.');
        }

        // Mise √† jour du suivi pour inclure TCC
        function updateTrackingScreen() {
            const usage = DataManager.getToolUsage();
            const anxiety = DataManager.getAnxietyHistory();
            
            const totalSessions = usage.length;
            
            const toolCounts = {};
            usage.forEach(e => {
                toolCounts[e.tool] = (toolCounts[e.tool] || 0) + 1;
            });
            const favTool = Object.keys(toolCounts).reduce((a, b) => 
                toolCounts[a] > toolCounts[b] ? a : b, '');
            
            const avgAnxiety = anxiety.length > 0 ?
                (anxiety.reduce((sum, e) => sum + e.level, 0) / anxiety.length).toFixed(1) : 0;
            
            // S√©rie cons√©cutive
            const today = new Date().toISOString().split('T')[0];
            const uniqueDates = [...new Set(usage.map(e => 
                new Date(e.timestamp).toISOString().split('T')[0]
            ))].sort().reverse();
            
            let streak = 0;
            for (let i = 0; i < uniqueDates.length; i++) {
                const expectedDate = new Date();
                expectedDate.setDate(expectedDate.getDate() - i);
                const expectedDateStr = expectedDate.toISOString().split('T')[0];
                
                if (uniqueDates[i] === expectedDateStr) {
                    streak++;
                } else {
                    break;
                }
            }
            
            document.getElementById('total-sessions').textContent = totalSessions;
            
            const toolNames = {
                'emdr': 'EMDR',
                'breathing': 'Respiration',
                'crisis': 'Mode Crise',
                'tcc-thoughts': 'TCC Pens√©es',
                'tcc-emotions': 'TCC √âmotions',
                'tcc-journal': 'Journal TCC'
            };
            document.getElementById('favorite-tool').textContent = 
                toolNames[favTool] || '-';
            
            document.getElementById('avg-anxiety').textContent = 
                avgAnxiety > 0 ? avgAnxiety + '/10' : '-';
            
            document.getElementById('streak-days').textContent = streak;
        }

        // ============ FIN FONCTIONS TCC ============
    </script>
</body>
</html>
